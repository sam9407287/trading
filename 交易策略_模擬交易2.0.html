<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ“¬äº¤æ˜“ 2.0 - ç°¡åŒ–ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 32px;
        }
        
        .back-link {
            color: #3498db;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            color: #34495e;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }
        
        input:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; }
        
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #229954; }
        
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        
        .btn-warning { background: #f39c12; color: white; }
        .btn-warning:hover { background: #e67e22; }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-item {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #3498db;
            text-align: center;
        }
        
        .status-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .operations-log {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-item {
            padding: 10px;
            margin: 5px 0;
            background: #ecf0f1;
            border-left: 3px solid #3498db;
            border-radius: 2px;
            font-size: 13px;
            color: #34495e;
        }
        
        .empty-log {
            color: #95a5a6;
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
        
        .holdings {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .holding-item {
            padding: 12px;
            margin: 8px 0;
            background: #ecf0f1;
            border-left: 3px solid #27ae60;
            border-radius: 2px;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }
        
        .holding-item.short {
            border-left-color: #e74c3c;
            background: #ffebee;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âœ¨ æ¨¡æ“¬äº¤æ˜“ 2.0</h1>
            <a href="äº¤æ˜“ç­–ç•¥_æ±ºç­–æ¨¹.html" class="back-link">â† è¿”å›æ±ºç­–æ¨¹</a>
        </div>
        
        <div class="main-grid">
            <!-- å·¦å´ï¼šæ“ä½œå€ -->
            <div>
                <!-- ç”¨æˆ¶ä¿¡æ¯ -->
                <div class="section">
                    <h2>ğŸ‘¤ ç”¨æˆ¶ä¿¡æ¯</h2>
                    <div class="form-group">
                        <label>ç”¨æˆ¶ID</label>
                        <input type="text" id="user-id" placeholder="ä¾‹å¦‚: trader123">
                    </div>
                    <button class="btn btn-primary" onclick="loginUser()">ç™»å…¥</button>
                    <button class="btn btn-warning" onclick="logoutUser()">ç™»å‡º</button>
                </div>
                
                <!-- è³‡é‡‘ç®¡ç† -->
                <div class="section">
                    <h2>ğŸ’° è³‡é‡‘ç®¡ç†</h2>
                    <div class="form-group">
                        <label>åˆå§‹è³‡é‡‘</label>
                        <input type="number" id="initial-capital" placeholder="ä¾‹å¦‚: 10000" step="0.01">
                    </div>
                    <button class="btn btn-success" onclick="addCapital()">+ æ·»åŠ è³‡é‡‘</button>
                </div>
                
                <!-- è‚¡ç¥¨æ“ä½œ -->
                <div class="section">
                    <h2>ğŸ“ˆ è‚¡ç¥¨æ“ä½œ</h2>
                    <div class="form-group">
                        <label>è‚¡ç¥¨ä»£è™Ÿ</label>
                        <input type="text" id="stock-symbol" placeholder="ä¾‹å¦‚: AAPL">
                    </div>
                    <div class="form-group">
                        <label>æ“ä½œé¡å‹</label>
                        <select id="stock-action">
                            <option value="buy">è²·é€²</option>
                            <option value="sell">è³£å‡º</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è‚¡æ•¸</label>
                        <input type="number" id="stock-quantity" placeholder="æ•¸é‡" min="1">
                    </div>
                    <div class="form-group">
                        <label>åƒ¹æ ¼</label>
                        <input type="number" id="stock-price" placeholder="åƒ¹æ ¼" step="0.01" min="0">
                    </div>
                    <button class="btn btn-success" onclick="executeStockTrade()">åŸ·è¡Œè‚¡ç¥¨äº¤æ˜“</button>
                </div>
                
                <!-- æœŸæ¬Šæ“ä½œ -->
                <div class="section">
                    <h2>ğŸ“Š æœŸæ¬Šæ“ä½œ</h2>
                    <div class="form-group">
                        <label>æœŸæ¬Šé¡å‹</label>
                        <select id="option-type">
                            <option value="call">Callï¼ˆçœ‹æ¼²ï¼‰</option>
                            <option value="put">Putï¼ˆçœ‹è·Œï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ“ä½œ</label>
                        <select id="option-action">
                            <option value="buy">è²·å…¥</option>
                            <option value="sell">è³£å‡º</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è¡Œä½¿åƒ¹</label>
                        <input type="number" id="strike-price" placeholder="è¡Œä½¿åƒ¹" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>æ¬Šåˆ©é‡‘ï¼ˆæ¯è‚¡ï¼‰</label>
                        <input type="number" id="premium" placeholder="æ¬Šåˆ©é‡‘" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>åˆ°æœŸæ—¥æœŸ</label>
                        <input type="date" id="expiry-date">
                    </div>
                    <button class="btn btn-success" onclick="executeOptionTrade()">åŸ·è¡ŒæœŸæ¬Šäº¤æ˜“</button>
                </div>
            </div>
            
            <!-- å³å´ï¼šç‹€æ…‹é¡¯ç¤º -->
            <div>
                <!-- ç•¶å‰ç‹€æ…‹ -->
                <div class="section">
                    <h2>ğŸ“Š ç•¶å‰ç‹€æ…‹</h2>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">å¯ç”¨è³‡é‡‘</div>
                            <div class="status-value" id="available-cash">$0.00</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">ç¸½æŒè‚¡</div>
                            <div class="status-value" id="total-shares">0</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">å·²å¯¦ç¾æç›Š</div>
                            <div class="status-value" id="realized-pnl">$0.00</div>
                        </div>
                    </div>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">æœªå¯¦ç¾æç›Š</div>
                            <div class="status-value" id="unrealized-pnl">$0.00</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">ç¸½è³‡ç”¢åƒ¹å€¼</div>
                            <div class="status-value" id="total-assets">$0.00</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">ç¸½æç›Š</div>
                            <div class="status-value" id="total-pnl">$0.00</div>
                        </div>
                    </div>
                </div>
                
                <!-- æŒå€‰ç¸½è¦½ -->
                <div class="section">
                    <h2>ğŸ“Œ æŒå€‰ç¸½è¦½</h2>
                    <div class="holdings" id="holdings">
                        <div class="empty-log">ç„¡æŒå€‰</div>
                    </div>
                </div>
                
                <!-- æ“ä½œè¨˜éŒ„ -->
                <div class="section">
                    <h2>ğŸ“œ æ“ä½œè¨˜éŒ„</h2>
                    <div class="operations-log" id="log">
                        <div class="empty-log">å°šç„¡æ“ä½œè¨˜éŒ„</div>
                    </div>
                    <button class="btn btn-danger" onclick="clearAllData()" style="margin-top: 15px;">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // æ•¸æ“šå­˜å„²
        let userData = {
            userId: '',
            capital: 0,
            availableCash: 0,
            trades: [],
            holdings: {}
        };
        
        // ç™»å…¥ç”¨æˆ¶
        function loginUser() {
            const userId = document.getElementById('user-id').value.trim();
            if (!userId) {
                alert('è«‹è¼¸å…¥ç”¨æˆ¶ID');
                return;
            }
            userData.userId = userId;
            loadUserData();
            alert(`æ­¡è¿, ${userId}!`);
            updateDisplay();
        }
        
        // ç™»å‡ºç”¨æˆ¶
        function logoutUser() {
            userData.userId = '';
            alert('å·²ç™»å‡º');
            updateDisplay();
        }
        
        // åŠ è¼‰ç”¨æˆ¶æ•¸æ“š
        function loadUserData() {
            const key = `trader2.0_${userData.userId}`;
            const saved = localStorage.getItem(key);
            if (saved) {
                userData = JSON.parse(saved);
            }
        }
        
        // ä¿å­˜ç”¨æˆ¶æ•¸æ“š
        function saveUserData() {
            if (!userData.userId) return;
            const key = `trader2.0_${userData.userId}`;
            localStorage.setItem(key, JSON.stringify(userData));
        }
        
        // æ·»åŠ è³‡é‡‘
        function addCapital() {
            if (!userData.userId) {
                alert('è«‹å…ˆç™»å…¥');
                return;
            }
            const amount = parseFloat(document.getElementById('initial-capital').value);
            if (!amount || amount <= 0) {
                alert('è«‹è¼¸å…¥æ­£ç¢ºçš„é‡‘é¡');
                return;
            }
            userData.capital += amount;
            userData.availableCash += amount;
            userData.trades.push({
                type: 'æ·»åŠ è³‡é‡‘',
                amount: amount,
                date: new Date().toLocaleString('zh-TW')
            });
            document.getElementById('initial-capital').value = '';
            saveUserData();
            updateDisplay();
        }
        
        // åŸ·è¡Œè‚¡ç¥¨äº¤æ˜“
        function executeStockTrade() {
            if (!userData.userId) {
                alert('è«‹å…ˆç™»å…¥');
                return;
            }
            const symbol = document.getElementById('stock-symbol').value.trim();
            const action = document.getElementById('stock-action').value;
            const quantity = parseInt(document.getElementById('stock-quantity').value);
            const price = parseFloat(document.getElementById('stock-price').value);
            
            if (!symbol || !quantity || !price) {
                alert('è«‹å¡«å¯«å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            if (!userData.holdings[symbol]) {
                userData.holdings[symbol] = { shares: 0, avgCost: 0, trades: [] };
            }
            
            const holding = userData.holdings[symbol];
            const tradeValue = quantity * price;
            
            if (action === 'buy') {
                if (userData.availableCash < tradeValue) {
                    alert(`è³‡é‡‘ä¸è¶³ï¼éœ€è¦ $${tradeValue.toFixed(2)}, å¯ç”¨ $${userData.availableCash.toFixed(2)}`);
                    return;
                }
                const totalCost = (holding.shares * holding.avgCost) + (quantity * price);
                holding.shares += quantity;
                holding.avgCost = totalCost / holding.shares;
                userData.availableCash -= tradeValue;
            } else {
                if (holding.shares < quantity) {
                    alert(`æŒè‚¡ä¸è¶³ï¼æŒæœ‰ ${holding.shares} è‚¡, è¦è³£ ${quantity} è‚¡`);
                    return;
                }
                const realizedPnL = (price - holding.avgCost) * quantity;
                userData.trades.push({
                    type: 'å¯¦ç¾æç›Š',
                    symbol: symbol,
                    pnl: realizedPnL,
                    date: new Date().toLocaleString('zh-TW')
                });
                holding.shares -= quantity;
                userData.availableCash += tradeValue;
            }
            
            holding.trades.push({
                action: action,
                quantity: quantity,
                price: price,
                date: new Date().toLocaleString('zh-TW')
            });
            
            userData.trades.push({
                type: `${action === 'buy' ? 'è²·é€²' : 'è³£å‡º'} ${quantity}è‚¡ ${symbol}`,
                price: price,
                value: tradeValue,
                date: new Date().toLocaleString('zh-TW')
            });
            
            document.getElementById('stock-symbol').value = '';
            document.getElementById('stock-quantity').value = '';
            document.getElementById('stock-price').value = '';
            
            saveUserData();
            updateDisplay();
        }
        
        // åŸ·è¡ŒæœŸæ¬Šäº¤æ˜“
        function executeOptionTrade() {
            if (!userData.userId) {
                alert('è«‹å…ˆç™»å…¥');
                return;
            }
            
            const optionType = document.getElementById('option-type').value;
            const action = document.getElementById('option-action').value;
            const strikePrice = parseFloat(document.getElementById('strike-price').value);
            const premium = parseFloat(document.getElementById('premium').value);
            const expiryDate = document.getElementById('expiry-date').value;
            
            if (!strikePrice || !premium || !expiryDate) {
                alert('è«‹å¡«å¯«å®Œæ•´çš„æœŸæ¬Šä¿¡æ¯');
                return;
            }
            
            const optionValue = premium * 100; // æ¯å£100è‚¡
            
            if (action === 'buy') {
                if (userData.availableCash < optionValue) {
                    alert(`è³‡é‡‘ä¸è¶³ï¼éœ€è¦ $${optionValue.toFixed(2)}, å¯ç”¨ $${userData.availableCash.toFixed(2)}`);
                    return;
                }
                userData.availableCash -= optionValue;
            } else {
                userData.availableCash += optionValue;
            }
            
            userData.trades.push({
                type: `${action === 'buy' ? 'è²·å…¥' : 'è³£å‡º'} ${optionType.toUpperCase()} æœŸæ¬Š`,
                strikePrice: strikePrice,
                premium: premium,
                expiryDate: expiryDate,
                value: optionValue,
                date: new Date().toLocaleString('zh-TW')
            });
            
            document.getElementById('strike-price').value = '';
            document.getElementById('premium').value = '';
            document.getElementById('expiry-date').value = '';
            
            saveUserData();
            updateDisplay();
        }
        
        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            if (!userData.userId) {
                document.getElementById('available-cash').textContent = 'ï¼ˆæœªç™»å…¥ï¼‰';
                document.getElementById('total-shares').textContent = '0';
                document.getElementById('realized-pnl').textContent = '$0.00';
                document.getElementById('unrealized-pnl').textContent = '$0.00';
                document.getElementById('total-assets').textContent = '$0.00';
                document.getElementById('total-pnl').textContent = '$0.00';
                document.getElementById('holdings').innerHTML = '<div class="empty-log">æœªç™»å…¥</div>';
                document.getElementById('log').innerHTML = '<div class="empty-log">æœªç™»å…¥</div>';
                return;
            }
            
            // æ›´æ–°å¯ç”¨è³‡é‡‘
            document.getElementById('available-cash').textContent = `$${userData.availableCash.toFixed(2)}`;
            
            // è¨ˆç®—ç¸½æŒè‚¡å’ŒæŒå€‰åƒ¹å€¼
            let totalShares = 0;
            let holdingValue = 0;
            let unrealizedPnL = 0;
            
            for (const symbol in userData.holdings) {
                const holding = userData.holdings[symbol];
                totalShares += holding.shares;
                const value = holding.shares * holding.avgCost;
                holdingValue += value;
                // æœªå¯¦ç¾æç›Šéœ€è¦å¯¦æ™‚åƒ¹æ ¼ï¼Œé€™è£¡ç°¡åŒ–ç‚º0
            }
            
            document.getElementById('total-shares').textContent = totalShares;
            document.getElementById('unrealized-pnl').textContent = `$${unrealizedPnL.toFixed(2)}`;
            
            // è¨ˆç®—å·²å¯¦ç¾æç›Š
            let realizedPnL = 0;
            userData.trades.forEach(trade => {
                if (trade.pnl) realizedPnL += trade.pnl;
            });
            document.getElementById('realized-pnl').textContent = `$${realizedPnL.toFixed(2)}`;
            
            // ç¸½è³‡ç”¢åƒ¹å€¼
            const totalAssets = userData.availableCash + holdingValue;
            document.getElementById('total-assets').textContent = `$${totalAssets.toFixed(2)}`;
            
            // ç¸½æç›Š
            const totalPnL = realizedPnL + unrealizedPnL;
            document.getElementById('total-pnl').textContent = `$${totalPnL.toFixed(2)}`;
            
            // æ›´æ–°æŒå€‰ç¸½è¦½
            updateHoldingsDisplay();
            
            // æ›´æ–°æ“ä½œè¨˜éŒ„
            updateLogDisplay();
        }
        
        // æ›´æ–°æŒå€‰ç¸½è¦½
        function updateHoldingsDisplay() {
            const holdingsDiv = document.getElementById('holdings');
            const holdings = [];
            
            for (const symbol in userData.holdings) {
                const holding = userData.holdings[symbol];
                if (holding.shares !== 0) {
                    holdings.push({
                        symbol: symbol,
                        shares: holding.shares,
                        avgCost: holding.avgCost,
                        value: holding.shares * holding.avgCost
                    });
                }
            }
            
            if (holdings.length === 0) {
                holdingsDiv.innerHTML = '<div class="empty-log">ç„¡æŒå€‰</div>';
                return;
            }
            
            let html = '';
            holdings.forEach(h => {
                const isShort = h.shares < 0;
                html += `
                    <div class="holding-item ${isShort ? 'short' : ''}">
                        <div>
                            <strong>${h.symbol}</strong><br>
                            ${h.shares > 0 ? 'å¤šé ­' : 'ç©ºé ­'}: ${h.shares} è‚¡ @ $${h.avgCost.toFixed(2)}
                        </div>
                        <div style="text-align: right;">
                            $${h.value.toFixed(2)}
                        </div>
                    </div>
                `;
            });
            
            holdingsDiv.innerHTML = html;
        }
        
        // æ›´æ–°æ“ä½œè¨˜éŒ„
        function updateLogDisplay() {
            const logDiv = document.getElementById('log');
            if (userData.trades.length === 0) {
                logDiv.innerHTML = '<div class="empty-log">å°šç„¡æ“ä½œè¨˜éŒ„</div>';
                return;
            }
            
            let html = '';
            [...userData.trades].reverse().forEach(trade => {
                html += `
                    <div class="log-item">
                        <strong>${trade.type}</strong><br>
                        ${trade.date}
                    </div>
                `;
            });
            
            logDiv.innerHTML = html;
        }
        
        // æ¸…é™¤æ‰€æœ‰æ•¸æ“š
        function clearAllData() {
            if (!userData.userId) {
                alert('è«‹å…ˆç™»å…¥');
                return;
            }
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ï¼')) {
                userData.capital = 0;
                userData.availableCash = 0;
                userData.trades = [];
                userData.holdings = {};
                saveUserData();
                updateDisplay();
                alert('å·²æ¸…é™¤æ‰€æœ‰æ•¸æ“š');
            }
        }
        
        // é é¢åŠ è¼‰æ™‚æ›´æ–°é¡¯ç¤º
        window.addEventListener('load', updateDisplay);
    </script>
</body>
</html>

