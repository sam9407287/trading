<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜²å®ˆå‹å¥—åˆ©-ç´°ç¯€æ±ºç­–æ¨¹ - 150è‚¡æ¨¡å‹</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 18px;
        }
        
        .section {
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        
        .section h2 {
            color: #34495e;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .section h3 {
            color: #2c3e50;
            margin: 20px 0 10px 0;
            font-size: 20px;
        }
        
        .mermaid {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .action-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .result-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .risk-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .parameters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .param-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .param-item strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }
        
        ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        li {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 14px;
            }
            
            .section {
                padding: 20px;
                margin: 30px 0;
            }
            
            .section h2 {
                font-size: 20px;
            }
            
            .section h3 {
                font-size: 18px;
            }
            
            .mermaid {
                padding: 10px;
            }
            
            .parameters {
                grid-template-columns: 1fr;
            }
            
            /* å„€è¡¨æ¿éŸ¿æ‡‰å¼ */
            .section > div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
            
            .section input, .section button {
                font-size: 14px;
            }
        }
        
        @media (max-width: 768px) {
            /* æœªå¹³å€‰æŒå€‰å€åŸŸéŸ¿æ‡‰å¼ */
            div[style*="grid-template-columns: 1fr 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
            
            /* è¼¸å…¥å€åŸŸéŸ¿æ‡‰å¼ */
            div[style*="grid-template-columns: 2fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
            
            div[style*="grid-template-columns: 1fr 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
            
            /* æŒ‰éˆ•éŸ¿æ‡‰å¼ */
            div[style*="grid-template-columns: 1fr 1fr"] button {
                font-size: 12px;
                padding: 8px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .section {
                padding: 15px;
            }
            
            input, button {
                font-size: 14px !important;
                padding: 8px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="äº¤æ˜“ç­–ç•¥_é˜²å®ˆå‹ç­–ç•¥.html" class="back-link">â† è¿”å›é˜²å®ˆå‹ç­–ç•¥</a>
        <h1>ğŸŒ³ é˜²å®ˆå‹å¥—åˆ©-ç´°ç¯€æ±ºç­–æ¨¹</h1>
        <p class="subtitle">150è‚¡æ¨¡å‹ - å®Œæ•´æ±ºç­–æ¨¹ç‹€çµæ§‹</p>

        <!-- å‹•æ…‹å„€è¡¨æ¿ -->
        <div class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
            <h2 style="color: white; border-bottom-color: rgba(255,255,255,0.3);">ğŸ“Š å‹•æ…‹å„€è¡¨æ¿ - æ¨¡æ“¬æ¨¡å¼</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <!-- å·¦å´ï¼šè¼¸å…¥å€åŸŸ -->
                <div style="background: rgba(255,255,255,0.95); color: #2c3e50; padding: 20px; border-radius: 8px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“ è¼¸å…¥æŒå€‰èˆ‡æ“ä½œ</h3>
                    
                    <div style="margin-bottom: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">æ·»åŠ è³‡é‡‘</label>
                        <input type="number" id="add-capital" placeholder="ä¾‹å¦‚: 1000" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button onclick="addCapital()" style="width: 100%; margin-top: 5px; padding: 8px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">ğŸ’° æ·»åŠ è³‡é‡‘</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">é¸æ“‡/æ–°å¢è‚¡ç¥¨</label>
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px;">
                            <select id="stock-select" onchange="selectStock()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">-- é¸æ“‡è‚¡ç¥¨ --</option>
                            </select>
                            <input type="text" id="stock-symbol" placeholder="æ–°å¢è‚¡ç¥¨ä»£è™Ÿ" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="addNewStock()" style="width: 100%; margin-top: 5px; padding: 8px; background: #9c27b0; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">â• æ–°å¢è‚¡ç¥¨</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">è²·å…¥è‚¡ç¥¨</label>
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px;">
                            <input type="number" id="buy-shares" placeholder="è‚¡æ•¸" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="number" id="buy-price" placeholder="åƒ¹æ ¼" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="addBuyOperation()" style="width: 100%; margin-top: 10px; padding: 10px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">â• æ·»åŠ è²·å…¥</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">è³£å‡ºè‚¡ç¥¨</label>
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px;">
                            <input type="number" id="sell-shares" placeholder="è‚¡æ•¸" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="number" id="sell-price" placeholder="åƒ¹æ ¼" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="addSellOperation()" style="width: 100%; margin-top: 10px; padding: 10px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">â– æ·»åŠ è³£å‡º</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">è³£å‡º Callï¼ˆé–‹å€‰ï¼‰</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                            <input type="number" id="call-strike" placeholder="è¡Œæ¬Šåƒ¹" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="number" id="call-premium" placeholder="æ¬Šåˆ©é‡‘" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="date" id="call-expiry" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="addCallOperation()" style="width: 100%; margin-top: 10px; padding: 10px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">â• æ·»åŠ è³£ Call</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">è²·å…¥ Callï¼ˆå¹³å€‰ï¼‰</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                            <input type="number" id="buy-call-strike" placeholder="è¡Œæ¬Šåƒ¹" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="number" id="buy-call-premium" placeholder="è²·å›åƒ¹" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="date" id="buy-call-expiry" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="addBuyCallOperation()" style="width: 100%; margin-top: 10px; padding: 10px; background: #9c27b0; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">â– è²·å› Call</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">è³£å‡º Putï¼ˆé–‹å€‰ï¼‰</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                            <input type="number" id="put-strike" placeholder="è¡Œæ¬Šåƒ¹" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="number" id="put-premium" placeholder="æ¬Šåˆ©é‡‘" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="date" id="put-expiry" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="addPutOperation()" style="width: 100%; margin-top: 10px; padding: 10px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">â• æ·»åŠ è³£ Put</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">è²·å…¥ Putï¼ˆå¹³å€‰ï¼‰</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                            <input type="number" id="buy-put-strike" placeholder="è¡Œæ¬Šåƒ¹" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="number" id="buy-put-premium" placeholder="è²·å›åƒ¹" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="date" id="buy-put-expiry" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="addBuyPutOperation()" style="width: 100%; margin-top: 10px; padding: 10px; background: #9c27b0; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">â– è²·å› Put</button>
                    </div>
                    
                    <div style="margin-bottom: 15px; padding: 15px; background: #fff3e0; border-radius: 8px; border: 2px solid #ff9800;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">âš¡ æœŸæ¬Šè¢«è¡Œä½¿</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <select id="exercise-call-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">é¸æ“‡è¢«è¡Œä½¿çš„Call</option>
                            </select>
                            <input type="number" id="exercise-price" placeholder="è¡Œä½¿åƒ¹æ ¼" step="0.01" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button onclick="exerciseCall()" style="padding: 10px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">ğŸ“ Callè¢«è¡Œä½¿</button>
                            <button onclick="exercisePut()" style="padding: 10px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">ğŸ“‰ Putè¢«è¡Œä½¿</button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button onclick="clearAll()" style="padding: 10px; background: #757575; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰</button>
                        <button onclick="saveData()" style="padding: 10px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">ğŸ’¾ ä¿å­˜æ•¸æ“š</button>
                    </div>
                </div>
                
                <!-- å³å´ï¼šç‹€æ…‹é¡¯ç¤º -->
                <div style="background: rgba(255,255,255,0.95); color: #2c3e50; padding: 20px; border-radius: 8px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“ˆ ç•¶å‰ç‹€æ…‹</h3>
                    
                    <div id="current-status" style="margin-bottom: 20px;">
                        <div style="padding: 15px; background: #e3f2fd; border-radius: 8px; margin-bottom: 10px;">
                            <strong>ç¸½æŒè‚¡æ•¸ï¼š</strong><span id="total-shares">0</span> è‚¡
                        </div>
                        <div style="padding: 15px; background: #fff3e0; border-radius: 8px; margin-bottom: 10px;">
                            <strong>å¹³å‡æˆæœ¬ï¼š</strong>$<span id="avg-cost">0.00</span>
                        </div>
                        <div style="padding: 15px; background: #e8f5e9; border-radius: 8px; margin-bottom: 10px;">
                            <strong>ç•¶å‰éšæ®µï¼š</strong><span id="current-stage">æœªé–‹å§‹</span>
                        </div>
                        <div style="padding: 15px; background: #fce4ec; border-radius: 8px; margin-bottom: 10px;">
                            <strong>æ±ºç­–æ¨¹ç¯€é»ï¼š</strong><span id="decision-node">ç­‰å¾…è¼¸å…¥æ•¸æ“š</span>
                        </div>
                        <div style="padding: 15px; background: #fff9c4; border-radius: 8px; margin-bottom: 10px;">
                            <strong>å·²å¯¦ç¾æç›Šï¼š</strong><span id="realized-pnl" style="font-weight: bold;">$0.00</span>
                        </div>
                        <div style="padding: 15px; background: #e1f5ff; border-radius: 8px;">
                            <strong>æœªå¯¦ç¾æç›Šï¼š</strong><span id="unrealized-pnl" style="font-weight: bold;">$0.00</span>
                        </div>
                        <div style="padding: 15px; background: #f3e5f5; border-radius: 8px; margin-top: 10px;">
                            <strong>ç¸½è³‡ç”¢åƒ¹å€¼ï¼š</strong><span id="total-assets" style="font-weight: bold; color: #9c27b0;">$0.00</span>
                        </div>
                        <div style="padding: 15px; background: #e8f5e9; border-radius: 8px; margin-top: 10px;">
                            <strong>å¯ç”¨è³‡é‡‘ï¼š</strong><span id="available-cash" style="color: #4caf50; font-weight: bold;">$0.00</span>
                        </div>
                    </div>
                    
                    <h4 style="color: #2c3e50; margin: 20px 0 10px 0;">ğŸ“‹ æ“ä½œå»ºè­°èˆ‡ä»»å‹™æ¸…å–®</h4>
                    <div id="task-list" style="min-height: 100px; margin-bottom: 20px;">
                        <p style="color: #999; font-style: italic;">è«‹è¼¸å…¥æŒå€‰æ•¸æ“šä»¥ç”Ÿæˆä»»å‹™</p>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 8px; border: 2px solid #4caf50;">
                        <h4 style="color: #2c3e50; margin: 0 0 10px 0;">ğŸ¤– æ™ºèƒ½æ“ä½œå»ºè­°</h4>
                        <div id="smart-suggestions" style="min-height: 50px;">
                            <p style="color: #999; font-style: italic; font-size: 0.9em;">è¼¸å…¥å³æ™‚è‚¡åƒ¹å¾Œé»æ“Šç¢ºèªç²å–å»ºè­°</p>
                        </div>
                        <button onclick="generateSmartSuggestions()" style="width: 100%; margin-top: 10px; padding: 10px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">âœ… ç¢ºèªä¸¦ç²å–æ“ä½œå»ºè­°</button>
                    </div>
                </div>
            </div>
            
            <!-- æœªå¹³å€‰æŒå€‰é¡¯ç¤º -->
            <div style="margin-top: 20px; background: rgba(255,255,255,0.95); color: #2c3e50; padding: 20px; border-radius: 8px;">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“Š æœªå¹³å€‰æŒå€‰èˆ‡å³æ™‚åƒ¹æ ¼</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <!-- è‚¡ç¥¨æŒå€‰ -->
                    <div>
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">è‚¡ç¥¨æŒå€‰</h4>
                        <div id="stock-positions" style="min-height: 50px;">
                            <p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡è‚¡ç¥¨æŒå€‰</p>
                        </div>
                        <div style="margin-top: 10px;">
                            <label style="display: block; margin-bottom: 5px; font-size: 0.9em; font-weight: 500;">å³æ™‚è‚¡åƒ¹</label>
                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 5px;">
                                <input type="number" id="current-stock-price" placeholder="è¼¸å…¥å³æ™‚è‚¡åƒ¹" step="0.01" onchange="updatePnL(); savePrices();" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <button onclick="updateStockPrice()" style="padding: 8px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em;">æ›´æ–°</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CallæŒå€‰ -->
                    <div>
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">CallæŒå€‰</h4>
                        <div id="call-positions" style="min-height: 50px;">
                            <p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡CallæŒå€‰</p>
                        </div>
                    </div>
                    
                    <!-- PutæŒå€‰ -->
                    <div>
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">PutæŒå€‰</h4>
                        <div id="put-positions" style="min-height: 50px;">
                            <p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡PutæŒå€‰</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ“ä½œæ­·å² -->
            <div style="margin-top: 20px; background: rgba(255,255,255,0.95); color: #2c3e50; padding: 20px; border-radius: 8px;">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“œ æ“ä½œæ­·å²</h3>
                <div id="operation-history" style="max-height: 200px; overflow-y: auto;">
                    <p style="color: #999; font-style: italic;">å°šç„¡æ“ä½œè¨˜éŒ„</p>
                </div>
            </div>
        </div>

        <!-- ç³»çµ±åƒæ•¸ -->
        <div class="section">
            <h2>ç³»çµ±åƒæ•¸ç¯„ä¾‹</h2>
            <div class="parameters">
                <div class="param-item">
                    <strong>ç›®æ¨™è‚¡ç¥¨</strong>
                    CRML
                </div>
                <div class="param-item">
                    <strong>åˆå§‹è²·å…¥åƒ¹</strong>
                    $11.00
                </div>
                <div class="param-item">
                    <strong>é—œéµé˜»åŠ› (Call Strike)</strong>
                    $12.00 (åŸå§‹ POC)
                </div>
                <div class="param-item">
                    <strong>é—œéµæ”¯æ’ (Put Strike)</strong>
                    $9.00 (äºŒæ¬¡åŠ å€‰ç›®æ¨™åƒ¹)
                </div>
                <div class="param-item">
                    <strong>ç³»çµ±æ¨¡å‹</strong>
                    150 è‚¡æ¨¡å‹
                </div>
                <div class="param-item">
                    <strong>é å‚™ç¾é‡‘</strong>
                    å·²é ç•™è¶³å¤ ç¾é‡‘ï¼Œæº–å‚™åœ¨ $9.00 åŸ·è¡Œ Short Put
                </div>
            </div>
        </div>

        <!-- éšæ®µä¸€ï¼šæ¨¹å¹¹ -->
        <div class="section">
            <h2>éšæ®µä¸€ï¼šæ¨¹å¹¹ï¼ˆThe Trunkï¼‰- åˆå§‹å»ºå€‰</h2>
            <div class="action-box">
                <h3>è¡Œå‹• 1ï¼ˆè²·å…¥ï¼‰</h3>
                <p>è²·å…¥ 150 è‚¡è‚¡ç¥¨ @ $11.00 (ç¸½æˆæœ¬ $1650)</p>
            </div>
            <div class="action-box">
                <h3>è¡Œå‹• 2ï¼ˆè³£ Callï¼‰</h3>
                <p>ç«‹å³è³£å‡º 1 å£æœ¬é€±åˆ°æœŸçš„ $12.00 Covered Call (å‡è¨­æ”¶åˆ° $50)</p>
            </div>
            <div class="action-box">
                <h3>è¡Œå‹• 3ï¼ˆæ›å–®ï¼‰</h3>
                <p>ç«‹å³æ›ä¸€å¼µ GTCï¼ˆé•·æ•ˆå–®ï¼‰è¨‚å–®ï¼Œä»¥ $5 çš„åƒ¹æ ¼ã€Œè²·å›ã€æ‚¨å‰›æ‰è³£å‡ºçš„ Callï¼ˆé–å®š 90% åˆ©æ½¤ï¼‰</p>
            </div>
            <div class="info-box">
                <strong>åˆå§‹ç‹€æ…‹ï¼š</strong>æ‚¨æŒæœ‰ 150 è‚¡ã€‚100 è‚¡è¢« Call è¦†è“‹ï¼ˆæœ‰æ•ˆæˆæœ¬ $10.50ï¼‰ï¼Œ50 è‚¡æ˜¯æ‚¨çš„ã€Œè‡ªç”±è‚¡ã€ã€‚æ‚¨é–‹å§‹ç­‰å¾…å¸‚å ´è§¸ç™¼æ‚¨çš„ GTC è¨‚å–®æˆ–åˆ°æœŸçµç®—ã€‚
            </div>
        </div>

        <!-- éšæ®µäºŒï¼šåˆ†å²” -->
        <div class="section">
            <h2>éšæ®µäºŒï¼šåˆ†å²”ï¼ˆThe Forkï¼‰- é€±ä¸­ç®¡ç†</h2>
            <p>æ‚¨åªå° GTC è¨‚å–®æˆäº¤ï¼ˆ$5 è²·å›ï¼‰åšå‡ºåæ‡‰ã€‚</p>
            
            <div class="mermaid">
graph TD
    START[åˆå§‹å»ºå€‰<br/>150è‚¡ + $12 Call] --> GTC{GTCè¨‚å–®æˆäº¤?}
    
    GTC -->|å¦| SETTLE[ç­‰å¾…çµç®—]
    GTC -->|æ˜¯| REASON{æˆäº¤åŸå› ?}
    
    REASON -->|åƒ¹æ ¼å‹åˆ©| D1[æƒ…å¢ƒD1:<br/>è‚¡åƒ¹ä¸‹è·Œè‡³$10<br/>è§¸ç™¼Path B]
    REASON -->|æ™‚é–“å‹åˆ©| D2[æƒ…å¢ƒD2:<br/>Thetaè€—æ<br/>æ™‚é–“åƒ¹å€¼è€—ç›¡]
    
    D1 --> D1ACTION[è³£å‡º25è‚¡@$10<br/>è³£å‡ºShort Strangle<br/>$12 Call + $9 Put]
    D2 --> D2ACTION[è³£å‡ºä¸‹é€±$12 Call<br/>é‡æ–°æ”¶ç§Ÿ]
    
    style START fill:#e3f2fd,stroke:#2196f3,stroke-width:3px
    style D1 fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style D2 fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
            </div>

            <div class="section" style="margin-top: 20px; padding: 20px;">
                <h3>ğŸŒ³ æƒ…å¢ƒ D1ï¼šã€Œåƒ¹æ ¼å‹åˆ©ã€ï¼ˆå› è‚¡åƒ¹ä¸‹è·Œï¼‰</h3>
                <div class="info-box">
                    <strong>ç‹€æ³ï¼š</strong>é€±äºŒæˆ–é€±ä¸‰ï¼Œè‚¡åƒ¹ä¸‹è·Œè‡³ $10.00ã€‚æ‚¨çš„ $12 Call åƒ¹å€¼å´©è·Œè‡³ $5ï¼Œè¨‚å–®æˆäº¤ã€‚
                </div>
                <div class="action-box">
                    <strong>åˆ†æï¼š</strong>å¸‚å ´è§¸ç™¼äº†æ‚¨çš„ã€ŒPath Bï¼šäºŒæ¬¡åŠ å€‰ã€è¨Šè™Ÿã€‚é€™æ˜¯æ¨¹ç‹€åœ–çš„ä¸»è¦åˆ†æã€‚
                </div>
                <div class="action-box">
                    <strong>è¡Œå‹•ï¼š</strong>
                    <ul>
                        <li>è³£å‡º 25 è‚¡è‚¡ç¥¨ @ $10.00ï¼ˆå¯¦ç¾ 25 è‚¡ @ $1.00 çš„è™§æï¼‰</li>
                        <li>æ‚¨æ‰‹ä¸Šé‚„å‰© 125 è‚¡ï¼ˆ100 è‚¡ @ $11 + 25 è‚¡ @ $11ï¼‰</li>
                        <li>å‹•ç”¨ã€Œé å‚™ç¾é‡‘ã€+ å‰›è³£å‡ºçš„ $250 + æ–°æ¬Šåˆ©é‡‘</li>
                        <li>ç«‹å³è³£å‡º 1 å£ä¸‹é€±çš„ Short Strangleï¼ˆå‹’å¼ï¼‰ï¼š
                            <ul>
                                <li>è³£ 1 å£ä¸‹é€± $12.00 Callï¼ˆç®¡ç†æ‚¨çš„ $11 æˆæœ¬æŒè‚¡ï¼‰</li>
                                <li>è³£ 1 å£ä¸‹é€± $9.00 Putï¼ˆæ‚¨çš„åŠ å€‰ç›®æ¨™ï¼‰</li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="result-box">
                    <strong>æ–°ç‹€æ…‹ï¼š</strong>æ‚¨æŒæœ‰ 125 è‚¡ + Short 1 Call @ $12 + Short 1 Put @ $9ã€‚<br>
                    <strong>Whipsaw (V è½‰) é¢¨éšªå°æ²–ï¼š</strong>æ‚¨æ‰‹ä¸Šé‚„æœ‰ 25 è‚¡ã€Œè‡ªç”±è‚¡ã€ï¼Œé€™ 25 è‚¡åœ¨ V è½‰æš´æ¼²æ™‚ï¼Œåˆ©æ½¤ä¸æœƒè¢« $12 Call é–æ­»ã€‚
                </div>
            </div>

            <div class="section" style="margin-top: 20px; padding: 20px;">
                <h3>ğŸŒ³ æƒ…å¢ƒ D2ï¼šã€Œæ™‚é–“å‹åˆ©ã€ï¼ˆå›  Theta è€—æï¼‰</h3>
                <div class="info-box">
                    <strong>ç‹€æ³ï¼š</strong>é€±å››ä¸‹åˆæˆ–é€±äº”æ—©ä¸Šã€‚è‚¡åƒ¹æ©«ç›¤åœ¨ $11.50 é™„è¿‘ã€‚æ™‚é–“åƒ¹å€¼è€—ç›¡ï¼Œè¨‚å–®æˆäº¤ã€‚
                </div>
                <div class="action-box">
                    <strong>åˆ†æï¼š</strong>Path B æœªè§¸ç™¼ã€‚é€™æ˜¯ä¸€å€‹ã€Œå°åˆ†æã€ã€‚
                </div>
                <div class="action-box">
                    <strong>è¡Œå‹•ï¼š</strong>ç«‹å³è³£å‡º 1 å£ä¸‹é€±çš„ $12.00 Callã€‚é‡æ–°é–‹å§‹ã€Œæ”¶ç§Ÿã€ï¼Œä¸¦æ›å¥½æ–°çš„ $5 GTC è²·å›å–®ã€‚
                </div>
            </div>
        </div>

        <!-- éšæ®µä¸‰ï¼šçµç®— -->
        <div class="section">
            <h2>éšæ®µä¸‰ï¼šçµç®—ï¼ˆThe Outcomeï¼‰- é€±äº”æ”¶ç›¤</h2>
            <p>å‡è¨­æ‚¨çš„ GTC è¨‚å–®å¾æœªæˆäº¤ï¼Œæ‚¨æŒæœ‰å€‰ä½ç›´åˆ°çµç®—ã€‚</p>
            
            <div class="mermaid">
graph TD
    SETTLE[é€±äº”çµç®—] --> PRICE{è‚¡åƒ¹æ”¶ç›¤åƒ¹?}
    
    PRICE -->|> $12.00| A[æƒ…å¢ƒA: ä¸Šæ¼²<br/>è¡Œæ¬Š]
    PRICE -->|< $12.00| BC[æƒ…å¢ƒB/C: æ©«ç›¤æˆ–ä¸‹è·Œ<br/>CalléæœŸä½œå»¢]
    
    A --> A_RESULT[100è‚¡@$12è³£å‡º<br/>ç²åˆ©$150<br/>å‰©é¤˜50è‚¡è‡ªç”±è‚¡]
    BC --> BC_RESULT[æ·¨è³º$50æ¬Šåˆ©é‡‘<br/>ä»æŒæœ‰150è‚¡]
    
    style A fill:#c8e6c9,stroke:#4caf50,stroke-width:2px
    style BC fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style A_RESULT fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    style BC_RESULT fill:#fff3e0,stroke:#ff9800,stroke-width:2px
            </div>

            <div class="result-box" style="margin-top: 20px;">
                <h3>ğŸ”´ æƒ…å¢ƒ Aï¼šã€Œä¸Šæ¼²ã€ï¼ˆè‚¡åƒ¹æ”¶ç›¤ > $12.00ï¼‰</h3>
                <p><strong>çµæœï¼š</strong>è¡Œæ¬Šã€‚æ‚¨çš„ 100 è‚¡ä»¥ $12 çš„åƒ¹æ ¼è¢«è‡ªå‹•è³£å‡ºã€‚</p>
                <p><strong>ç²åˆ©ï¼ˆ100 è‚¡ï¼‰ï¼š</strong>($12.00 è³£å‡ºåƒ¹ - $11.00 è²·å…¥åƒ¹) + $0.50 æ¬Šåˆ©é‡‘ = æ¯è‚¡ $1.50 (ç¸½ç²åˆ© $150)</p>
                <p><strong>æ–°ç‹€æ…‹ï¼š</strong>æ‚¨æ‰‹ä¸Šæœ‰ 50 è‚¡ã€Œè‡ªç”±è‚¡ã€ + å¤§é‡ç¾é‡‘ã€‚</p>
                <p><strong>çµè«–ï¼š</strong>å®Œç¾å¯¦ç¾ Path Aã€‚ã€Œä¸éŒ¯éä¸å¾Œæ‚”ã€ã€‚</p>
            </div>

            <div class="info-box" style="margin-top: 20px;">
                <h3>ğŸŸ¡ æƒ…å¢ƒ B/Cï¼šã€Œæ©«ç›¤æˆ–ä¸‹è·Œã€ï¼ˆè‚¡åƒ¹æ”¶ç›¤ < $12.00ï¼‰</h3>
                <p><strong>çµæœï¼š</strong>Call éæœŸä½œå»¢ã€‚æ‚¨æ·¨è³º $50 æ¬Šåˆ©é‡‘ã€‚</p>
                <p><strong>æ–°ç‹€æ…‹ï¼š</strong>æ‚¨æ‰‹ä¸Šä¾ç„¶æ˜¯ 150 è‚¡ï¼ˆä½†ç¸½æˆæœ¬å·²é™ä½ï¼‰ã€‚</p>
                <p><strong>çµè«–ï¼š</strong>æˆåŠŸã€Œæ”¶ç§Ÿã€ã€‚</p>
            </div>
        </div>

        <!-- éšæ®µå››ï¼šæè‘‰ -->
        <div class="section">
            <h2>éšæ®µå››ï¼šæè‘‰ï¼ˆThe Twigsï¼‰- ä¸‹é€±ä¸€é‡å•Ÿ</h2>
            <p>æ‚¨å°‡æ ¹æ“šä¸Šé€±çš„çµç®—çµæœï¼Œé•·å‡ºæ–°çš„ã€Œæè‘‰ã€ã€‚</p>
            
            <div class="mermaid">
graph TD
    RESTART[ä¸‹é€±ä¸€é‡å•Ÿ] --> RESULT{ä¸Šé€±çµç®—çµæœ?}
    
    RESULT -->|æƒ…å¢ƒA| A_RESTART[å‰©é¤˜50è‚¡+ç¾é‡‘<br/>åªè³£Putéšæ®µ]
    RESULT -->|æƒ…å¢ƒB/C| BC_RESTART[å‰©é¤˜150è‚¡<br/>è¿”å›éšæ®µä¸€]
    RESULT -->|æƒ…å¢ƒD1| D1_RESTART[å‰©é¤˜125è‚¡+Strangle<br/>Strangleç®¡ç†åˆ†æ”¯]
    
    A_RESTART --> A_ACTION[è³£Put @ $11.50<br/>æ›GTCè²·å›<br/>ç›®æ¨™: è²·å›100è‚¡]
    
    BC_RESTART --> BC_ACTION[è³£ä¸‹é€±Call @ $12<br/>æ›GTCè²·å›]
    
    D1_RESTART --> D1_SETTLE{Strangleçµç®—?}
    D1_SETTLE -->|Callè¡Œæ¬Š| D1_1[å‰©é¤˜25è‚¡<br/>åªè³£Putéšæ®µ]
    D1_SETTLE -->|Putè¡Œæ¬Š| D1_2[å‰©é¤˜225è‚¡<br/>é«˜ä½é…æ”¶ç§Ÿ]
    D1_SETTLE -->|éƒ½æœªè¡Œæ¬Š| D1_3[å‰©é¤˜125è‚¡<br/>ç¹¼çºŒShort Strangle]
    
    D1_2 --> D1_2_ACTION[è³£Call @ $10<br/>è³£Call @ $12<br/>ç®¡ç†ä¸åŒæˆæœ¬å±¤]
    
    style A_RESTART fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    style BC_RESTART fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style D1_RESTART fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    style D1_2 fill:#ffebee,stroke:#f44336,stroke-width:2px
            </div>

            <div class="action-box" style="margin-top: 20px;">
                <h3>A ä¹‹é‡å•Ÿï¼ˆæ‚¨å‰©ä¸‹ 50 è‚¡ + ç¾é‡‘ï¼‰</h3>
                <p><strong>è¡Œå‹•ï¼š</strong>ã€Œåªè³£ Put éšæ®µã€</p>
                <ul>
                    <li>è³£å‡º Put (Cash-Secured Put)ï¼šå‹•ç”¨æ‚¨çš„ç¾é‡‘ï¼Œå»è³£ä¸€å£ä¸‹é€±çš„ã€åƒ¹å¤–çš„ Putï¼ˆä¾‹å¦‚ $11.50 æˆ– $11ï¼‰</li>
                    <li>æ›å–®ï¼šæ› GTC è¨‚å–®è²·å›é€™å£ Putï¼ˆé–å®š 80-90% åˆ©æ½¤ï¼‰</li>
                    <li>ç›®çš„ï¼šã€Œè³º put çš„æ¬Šåˆ©é‡‘ä»¥æ­¤å¾ªç’°ã€ã€‚å¦‚æœè¢«è¡Œæ¬Šï¼Œæ‚¨ä»¥ä½åƒ¹è²·å› 100 è‚¡ï¼Œå€‰ä½å›åˆ° 150 è‚¡ï¼Œé‡è¿”ã€Œéšæ®µä¸€ã€</li>
                </ul>
            </div>

            <div class="action-box" style="margin-top: 20px;">
                <h3>B / C ä¹‹é‡å•Ÿï¼ˆæ‚¨å‰©ä¸‹ 150 è‚¡ï¼‰</h3>
                <p><strong>è¡Œå‹•ï¼š</strong>è¿”å›ã€Œéšæ®µä¸€ã€</p>
                <ul>
                    <li>è³£å‡º 1 å£ä¸‹é€±çš„ Callï¼ˆè¡Œä½¿åƒ¹ $12 æˆ–ä¸‹èª¿ï¼‰</li>
                    <li>æ› GTC è¨‚å–®è²·å›</li>
                </ul>
            </div>

            <div class="section" style="margin-top: 20px; padding: 20px; background: #f3e5f5;">
                <h3>D1 ä¹‹é‡å•Ÿï¼ˆæ‚¨å‰©ä¸‹ 125 è‚¡ + Strangleï¼‰</h3>
                <p><strong>è¡Œå‹•ï¼š</strong>æ‚¨ç¾åœ¨é€²å…¥äº†æ¨¹ç‹€åœ–æœ€è¤‡é›œçš„ã€ŒStrangle ç®¡ç†ã€åˆ†æ”¯ã€‚</p>
                <ul>
                    <li>GTCï¼šæ› GTC è¨‚å–®åˆ†åˆ¥è²·å› Call å’Œ Putï¼ˆé–å®š 80-90% åˆ©æ½¤ï¼‰</li>
                    <li>ç­‰å¾…çµç®—ï¼š</li>
                </ul>

                <div class="action-box" style="margin-top: 15px;">
                    <h4>D1.1 (Strangle Call @ $12 è¡Œæ¬Š)ï¼š</h4>
                    <p><strong>æ–°æŒå€‰ï¼š</strong>æ‚¨æ‰‹ä¸Šã€Œåªå‰©ä¸‹ 25 è‚¡ã€ï¼ˆ100 è‚¡è¢«è³£å‡ºï¼‰</p>
                    <p><strong>è¡Œå‹•ï¼š</strong>ã€Œåªè³£ Put éšæ®µã€ã€‚é–‹å§‹è³£ Putï¼Œè©¦åœ–æŠŠæŒè‚¡æ‹‰å› 125 è‚¡ã€‚</p>
                </div>

                <div class="action-box" style="margin-top: 15px;">
                    <h4>D1.2 (Strangle Put @ $9 è¡Œæ¬Š)ï¼š</h4>
                    <p><strong>æ–°æŒå€‰ï¼š</strong>æ‚¨è¢«è¿«è²·å…¥ 100 è‚¡ï¼Œæ‰‹ä¸Šã€Œå‰©ä¸‹ 225 è‚¡ã€</p>
                    <p><strong>æˆæœ¬åˆ†å±¤ï¼š</strong>(125 è‚¡ @ $11) + (100 è‚¡ @ $9)</p>
                    <p><strong>è¡Œå‹•ï¼ˆæ‚¨çš„ã€Œé«˜ä½é…ã€æ”¶ç§Ÿç­–ç•¥ï¼‰ï¼š</strong></p>
                    <ul>
                        <li>è³£ 1 å£ Call @ $10.00ï¼ˆã€Œæ¯”æˆæœ¬é«˜ä¸€å…ƒã€ï¼Œç®¡ç†æ‚¨ $9 çš„æŒè‚¡ï¼‰</li>
                        <li>è³£ 1 å£ Call @ $12.00ï¼ˆåŸå§‹ POCï¼Œç®¡ç†æ‚¨ $11 çš„æŒè‚¡ï¼‰</li>
                    </ul>
                    <p><strong>å¾ŒçºŒæ¼”åŒ–ï¼š</strong></p>
                    <ul>
                        <li>å¦‚æœ $10 Call è¢«è¡Œæ¬Šï¼ˆè‚¡åƒ¹ $10.50ï¼‰ï¼šæ‚¨å›åˆ° 125 è‚¡ + 1 Call @ $12 çš„ç‹€æ…‹ï¼Œä¸¦æº–å‚™ã€Œå›åˆ° Strangleã€ï¼ˆè³£ $9 Putï¼‰</li>
                        <li>å¦‚æœ $10 å’Œ $12 Call éƒ½è¢«è¡Œæ¬Šï¼ˆè‚¡åƒ¹ > $12ï¼‰ï¼šæ‚¨å›åˆ° 25 è‚¡ç‹€æ…‹ï¼Œé€²å…¥ã€Œåªè³£ Put éšæ®µã€</li>
                    </ul>
                </div>

                <div class="action-box" style="margin-top: 15px;">
                    <h4>D1.3 (å…©é‚Šéƒ½æœªè¡Œæ¬Š)ï¼š</h4>
                    <p><strong>æ–°æŒå€‰ï¼š</strong>æ‚¨æ‰‹ä¸Šä¾ç„¶æ˜¯ 125 è‚¡</p>
                    <p><strong>è¡Œå‹•ï¼š</strong>ã€Œç¹¼çºŒ short strangleã€ã€‚è³£ä¸‹é€±çš„ $9p / $12cï¼Œé‡è¤‡ D1 å¾ªç’°</p>
                </div>
            </div>
        </div>

        <!-- çµ‚å±€ -->
        <div class="section">
            <h2>çµ‚å±€ï¼šæ¨¹çš„é‚Šç•Œï¼ˆThe End of the Lineï¼‰</h2>
            
            <div class="result-box">
                <h3>çµ‚å±€ 1ï¼šã€Œå¤§æš´æ¼²ã€ï¼ˆç­–ç•¥å¤§ç²å…¨å‹ï¼‰</h3>
                <p><strong>ç‹€æ³ï¼š</strong>æ‚¨çš„ Call @ $12 è¢«è¡Œæ¬Šï¼Œä½†è‚¡åƒ¹é£†å‡åˆ° $20</p>
                <p><strong>å€‰ä½ï¼š</strong>æ‚¨çš„ 25 è‚¡æˆ– 50 è‚¡ã€Œè‡ªç”±è‚¡ã€</p>
                <p><strong>è¡Œå‹•ï¼š</strong>ä¸å†é¡å¤–æ“ä½œã€‚æ‚¨ä¸æœƒåœ¨ $20 å»è³£ Put è¿½é«˜ã€‚ç²åˆ©äº†çµï¼Œå¸¶è‘—åˆ©æ½¤é›¢å ´å°‹æ‰¾ä¸‹ä¸€å€‹ç›®æ¨™ã€‚</p>
            </div>

            <div class="risk-box">
                <h3>çµ‚å±€ 2ï¼šã€Œå¤§æš´è·Œã€ï¼ˆç­–ç•¥å”¯ä¸€å¤±æ•—ï¼‰</h3>
                <p><strong>ç‹€æ³ï¼š</strong>æ‚¨çš„ Put @ $9 è¢«è¡Œæ¬Šï¼ˆç¸½æŒå€‰ 225 è‚¡ï¼‰ï¼Œä½†è‚¡åƒ¹å´©ç›¤è‡³ $5</p>
                <p><strong>è¡Œå‹•ï¼š</strong>åœæ­¢æ‰€æœ‰æœŸæ¬Šæ“ä½œ</p>
                <ul>
                    <li>ä¸è³£ Putï¼šé¿å…æŒå€‰å¢åŠ åˆ° 325 è‚¡</li>
                    <li>ä¸è³£ Callï¼šé¿å…åœ¨ $6 é€™ç¨®ä½åƒ¹ã€Œé–å®šã€æ‚¨çš„å·¨å¤§è™§æï¼Œä¹Ÿé¿å…ç‚ºäº†å¹¾å¡ŠéŒ¢çš„æ¬Šåˆ©é‡‘ï¼Œè³£æ‰ $10-$12 çš„ã€Œç¿»èº«ã€æ©Ÿæœƒ</li>
                </ul>
                <p><strong>çµè«–ï¼š</strong>ã€Œæ»¾è¼ªå¥—åˆ©ã€ç³»çµ±åœ¨æ­¤å¤±æ•—ã€‚æ‚¨è½‰ç‚ºã€Œè¢«å‹•æŠ•è³‡è€…ã€ï¼ŒæŒæœ‰é€™ 225 è‚¡ï¼Œç­‰å¾…æœªä¾†åŸºæœ¬é¢åè½‰ã€‚</p>
            </div>
        </div>

        <!-- å®Œæ•´æ±ºç­–æ¨¹ç¸½è¦½ -->
        <div class="section">
            <h2>å®Œæ•´æ±ºç­–æ¨¹ç¸½è¦½</h2>
            <div class="mermaid">
flowchart TD
    START[éšæ®µä¸€: åˆå§‹å»ºå€‰<br/>150è‚¡ + $12 Call + GTC] --> WEEK[é€±ä¸­ç®¡ç†]
    
    WEEK --> GTC_CHECK{GTCæˆäº¤?}
    GTC_CHECK -->|å¦| FRIDAY[é€±äº”çµç®—]
    GTC_CHECK -->|æ˜¯| D1[æƒ…å¢ƒD1: åƒ¹æ ¼å‹åˆ©<br/>125è‚¡+Strangle]
    GTC_CHECK -->|æ˜¯| D2[æƒ…å¢ƒD2: æ™‚é–“å‹åˆ©<br/>é‡æ–°è³£Call]
    
    FRIDAY --> PRICE_CHECK{è‚¡åƒ¹?}
    PRICE_CHECK -->|> $12| A[æƒ…å¢ƒA: ä¸Šæ¼²<br/>50è‚¡+ç¾é‡‘]
    PRICE_CHECK -->|< $12| BC[æƒ…å¢ƒB/C: æ”¶ç§Ÿ<br/>150è‚¡]
    
    A --> A_NEXT[åªè³£Putéšæ®µ]
    BC --> BC_NEXT[è¿”å›éšæ®µä¸€]
    D1 --> D1_NEXT[Strangleç®¡ç†]
    D2 --> D2_NEXT[è¿”å›éšæ®µä¸€]
    
    D1_NEXT --> D1_RESULT{Strangleçµæœ?}
    D1_RESULT -->|Callè¡Œæ¬Š| D1_1[25è‚¡]
    D1_RESULT -->|Putè¡Œæ¬Š| D1_2[225è‚¡<br/>é«˜ä½é…]
    D1_RESULT -->|æœªè¡Œæ¬Š| D1_3[125è‚¡<br/>ç¹¼çºŒStrangle]
    
    D1_1 --> PUT_ONLY[åªè³£Putéšæ®µ]
    D1_2 --> HIGH_LOW[é«˜ä½é…æ”¶ç§Ÿ]
    D1_3 --> D1_NEXT
    
    A_NEXT --> PUT_ONLY
    PUT_ONLY --> RESTART[å¾ªç’°é‡å•Ÿ]
    BC_NEXT --> RESTART
    HIGH_LOW --> RESTART
    
    RESTART --> END1[çµ‚å±€1: å¤§æš´æ¼²<br/>ç²åˆ©äº†çµ]
    RESTART --> END2[çµ‚å±€2: å¤§æš´è·Œ<br/>è¢«å‹•æŒæœ‰]
    
    style START fill:#e3f2fd,stroke:#2196f3,stroke-width:3px
    style A fill:#c8e6c9,stroke:#4caf50,stroke-width:2px
    style BC fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style D1 fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    style D1_2 fill:#ffebee,stroke:#f44336,stroke-width:2px
    style END1 fill:#c8e6c9,stroke:#4caf50,stroke-width:3px
    style END2 fill:#ffcdd2,stroke:#f44336,stroke-width:3px
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                padding: 20
            },
            securityLevel: 'loose'
        });

        // å„€è¡¨æ¿æ•¸æ“šå­˜å„² - æ”¯æŒå¤šè‚¡ç¥¨
        let dashboardData = {
            capitalAdditions: [],  // [{amount: 1000, date: '2025/01/01'}]
            stocks: {}  // {symbol: {operations: [], calls: [], puts: [], buyCalls: [], buyPuts: []}}
        };
        
        let currentStock = '';  // ç•¶å‰é¸ä¸­çš„è‚¡ç¥¨
        
        let currentPrices = {
            stocks: {}  // {symbol: {stock: 0, calls: {}, puts: {}}}
        };

        // å¾localStorageè¼‰å…¥æ•¸æ“š
        function loadData() {
            const saved = localStorage.getItem('tradingDashboard');
            if (saved) {
                try {
                    const loaded = JSON.parse(saved);
                    dashboardData = loaded;
                    if (!dashboardData.stocks) {
                        dashboardData.stocks = {};
                    }
                    if (!dashboardData.capitalAdditions) {
                        dashboardData.capitalAdditions = [];
                    }
                    
                    // æ•¸æ“šé·ç§»ï¼šå¦‚æœæœ‰èˆŠçš„initialCapitalï¼Œè½‰æ›ç‚ºcapitalAdditions
                    if (loaded.initialCapital && loaded.initialCapital > 0 && dashboardData.capitalAdditions.length === 0) {
                        dashboardData.capitalAdditions.push({
                            amount: loaded.initialCapital,
                            date: new Date().toLocaleDateString('zh-TW'),
                            id: Date.now()
                        });
                        delete dashboardData.initialCapital;
                        saveData(); // ä¿å­˜é·ç§»å¾Œçš„æ•¸æ“š
                    }
                    
                    updateStockSelect();
                    if (Object.keys(dashboardData.stocks).length > 0) {
                        currentStock = Object.keys(dashboardData.stocks)[0];
                        document.getElementById('stock-select').value = currentStock;
                        updateDisplay();
                    }
                    updateAvailableCash();
                } catch (e) {
                    console.error('è¼‰å…¥æ•¸æ“šå¤±æ•—:', e);
                    dashboardData = {
                        capitalAdditions: [],
                        stocks: {}
                    };
                }
            } else {
                dashboardData = {
                    capitalAdditions: [],
                    stocks: {}
                };
            }
            loadPrices();
        }
        
        // è¼‰å…¥åƒ¹æ ¼
        function loadPrices() {
            const saved = localStorage.getItem('tradingPrices');
            if (saved) {
                currentPrices = JSON.parse(saved);
            }
        }
        
        // æ›´æ–°è‚¡ç¥¨é¸æ“‡ä¸‹æ‹‰æ¡†
        function updateStockSelect() {
            const select = document.getElementById('stock-select');
            const callSelect = document.getElementById('exercise-call-select');
            const currentValue = select.value;
            
            if (!select || !callSelect) return;
            
            select.innerHTML = '<option value="">-- é¸æ“‡è‚¡ç¥¨ --</option>';
            callSelect.innerHTML = '<option value="">é¸æ“‡è¢«è¡Œä½¿çš„Call</option>';
            
            if (!dashboardData.stocks) {
                dashboardData.stocks = {};
            }
            
            Object.keys(dashboardData.stocks).forEach(symbol => {
                const option = document.createElement('option');
                option.value = symbol;
                option.textContent = symbol;
                select.appendChild(option);
                
                // æ›´æ–°Callé¸æ“‡æ¡†
                const stock = dashboardData.stocks[symbol];
                if (stock && stock.calls) {
                    const openCalls = stock.calls.filter(c => !c.closed && !c.exercised);
                    openCalls.forEach(call => {
                        const callOption = document.createElement('option');
                        callOption.value = `${symbol}_${call.id}`;
                        callOption.textContent = `${symbol} $${call.strike} Call (${call.expiry})`;
                        callSelect.appendChild(callOption);
                    });
                }
            });
            
            if (currentValue && dashboardData.stocks[currentValue]) {
                select.value = currentValue;
            }
        }
        
        // æ·»åŠ è³‡é‡‘
        function addCapital() {
            const amount = parseFloat(document.getElementById('add-capital').value);
            if (amount > 0) {
                if (!dashboardData.capitalAdditions) {
                    dashboardData.capitalAdditions = [];
                }
                dashboardData.capitalAdditions.push({
                    amount: amount,
                    date: new Date().toLocaleDateString('zh-TW'),
                    id: Date.now()
                });
                document.getElementById('add-capital').value = '';
                updateAvailableCash();
                updateDisplay();
                saveData();
                alert(`å·²æˆåŠŸæ·»åŠ è³‡é‡‘ $${amount.toFixed(2)}ï¼`);
            } else {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é‡‘é¡');
            }
        }
        
        // æ–°å¢è‚¡ç¥¨
        function addNewStock() {
            const symbol = document.getElementById('stock-symbol').value.trim().toUpperCase();
            if (!symbol) {
                alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ');
                return;
            }
            
            if (!dashboardData.stocks) {
                dashboardData.stocks = {};
            }
            
            if (!dashboardData.stocks[symbol]) {
                dashboardData.stocks[symbol] = {
                    operations: [],
                    calls: [],
                    puts: [],
                    buyCalls: [],
                    buyPuts: []
                };
                currentStock = symbol;
                updateStockSelect();
                document.getElementById('stock-select').value = symbol;
                document.getElementById('stock-symbol').value = '';
                updateDisplay();
                saveData();
                alert(`è‚¡ç¥¨ ${symbol} å·²æˆåŠŸæ–°å¢ï¼`);
            } else {
                // å¦‚æœå·²å­˜åœ¨ï¼Œç›´æ¥é¸æ“‡å®ƒ
                currentStock = symbol;
                document.getElementById('stock-select').value = symbol;
                updateDisplay();
                alert(`è‚¡ç¥¨ ${symbol} å·²å­˜åœ¨ï¼Œå·²åˆ‡æ›åˆ°è©²è‚¡ç¥¨`);
            }
        }
        
        // é¸æ“‡è‚¡ç¥¨
        function selectStock() {
            const symbol = document.getElementById('stock-select').value;
            if (symbol && dashboardData.stocks[symbol]) {
                currentStock = symbol;
                updateDisplay();
            }
        }
        
        // ç²å–ç•¶å‰è‚¡ç¥¨æ•¸æ“š
        function getCurrentStockData() {
            if (!currentStock || !dashboardData.stocks[currentStock]) {
                return null;
            }
            return dashboardData.stocks[currentStock];
        }

        // ä¿å­˜æ•¸æ“šåˆ°localStorage
        function saveData() {
            localStorage.setItem('tradingDashboard', JSON.stringify(dashboardData));
            savePrices();
            alert('æ•¸æ“šå·²ä¿å­˜ï¼');
        }

        // æ·»åŠ è²·å…¥æ“ä½œ
        function addBuyOperation() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡æˆ–æ–°å¢è‚¡ç¥¨');
                return;
            }
            
            const stockData = getCurrentStockData();
            const shares = parseInt(document.getElementById('buy-shares').value);
            const price = parseFloat(document.getElementById('buy-price').value);
            
            if (!shares || !price) {
                alert('è«‹è¼¸å…¥å®Œæ•´çš„è²·å…¥ä¿¡æ¯');
                return;
            }

            stockData.operations.push({
                type: 'buy',
                shares: shares,
                price: price,
                date: new Date().toLocaleDateString('zh-TW'),
                id: Date.now(),
                symbol: currentStock
            });

            document.getElementById('buy-shares').value = '';
            document.getElementById('buy-price').value = '';
            updateAvailableCash();
            updateDisplay();
        }

        // æ·»åŠ è³£å‡ºæ“ä½œ
        function addSellOperation() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡æˆ–æ–°å¢è‚¡ç¥¨');
                return;
            }
            
            const stockData = getCurrentStockData();
            const shares = parseInt(document.getElementById('sell-shares').value);
            const price = parseFloat(document.getElementById('sell-price').value);
            
            if (!shares || !price) {
                alert('è«‹è¼¸å…¥å®Œæ•´çš„è³£å‡ºä¿¡æ¯');
                return;
            }

            stockData.operations.push({
                type: 'sell',
                shares: shares,
                price: price,
                date: new Date().toLocaleDateString('zh-TW'),
                id: Date.now(),
                symbol: currentStock
            });

            document.getElementById('sell-shares').value = '';
            document.getElementById('sell-price').value = '';
            updateAvailableCash();
            updateDisplay();
        }

        // æ·»åŠ è³£Callæ“ä½œ
        function addCallOperation() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡æˆ–æ–°å¢è‚¡ç¥¨');
                return;
            }
            
            const stockData = getCurrentStockData();
            const strike = parseFloat(document.getElementById('call-strike').value);
            const premium = parseFloat(document.getElementById('call-premium').value);
            const expiry = document.getElementById('call-expiry').value;
            
            if (!strike || !premium || !expiry) {
                alert('è«‹è¼¸å…¥å®Œæ•´çš„Callä¿¡æ¯');
                return;
            }

            stockData.calls.push({
                strike: strike,
                premium: premium,
                expiry: expiry,
                date: new Date().toLocaleDateString('zh-TW'),
                id: Date.now(),
                closed: false,
                symbol: currentStock,
                exercised: false
            });

            document.getElementById('call-strike').value = '';
            document.getElementById('call-premium').value = '';
            document.getElementById('call-expiry').value = '';
            updateStockSelect();
            updateAvailableCash();
            updateDisplay();
        }

        // æ·»åŠ è²·å…¥Callæ“ä½œï¼ˆå¹³å€‰ï¼‰
        function addBuyCallOperation() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡æˆ–æ–°å¢è‚¡ç¥¨');
                return;
            }
            
            const stockData = getCurrentStockData();
            const strike = parseFloat(document.getElementById('buy-call-strike').value);
            const premium = parseFloat(document.getElementById('buy-call-premium').value);
            const expiry = document.getElementById('buy-call-expiry').value;
            
            if (!strike || !premium || !expiry) {
                alert('è«‹è¼¸å…¥å®Œæ•´çš„Callä¿¡æ¯');
                return;
            }

            // å°‹æ‰¾åŒ¹é…çš„è³£Callä¾†å¹³å€‰
            const matchingCall = stockData.calls.find(c => 
                !c.closed && 
                !c.exercised &&
                Math.abs(c.strike - strike) < 0.01 && 
                c.expiry === expiry
            );

            if (matchingCall) {
                matchingCall.closed = true;
                matchingCall.closePrice = premium;
                matchingCall.closeDate = new Date().toLocaleDateString('zh-TW');
            } else {
                // å¦‚æœæ²’æœ‰åŒ¹é…çš„ï¼Œè¨˜éŒ„ç‚ºè²·å…¥Callï¼ˆå¯èƒ½æ˜¯æ–°çš„é–‹å€‰ï¼‰
                stockData.buyCalls.push({
                    strike: strike,
                    premium: premium,
                    expiry: expiry,
                    date: new Date().toLocaleDateString('zh-TW'),
                    id: Date.now(),
                    symbol: currentStock
                });
            }

            document.getElementById('buy-call-strike').value = '';
            document.getElementById('buy-call-premium').value = '';
            document.getElementById('buy-call-expiry').value = '';
            updateStockSelect();
            updateAvailableCash();
            updateDisplay();
        }

        // æ·»åŠ è³£Putæ“ä½œ
        function addPutOperation() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡æˆ–æ–°å¢è‚¡ç¥¨');
                return;
            }
            
            const stockData = getCurrentStockData();
            const strike = parseFloat(document.getElementById('put-strike').value);
            const premium = parseFloat(document.getElementById('put-premium').value);
            const expiry = document.getElementById('put-expiry').value;
            
            if (!strike || !premium || !expiry) {
                alert('è«‹è¼¸å…¥å®Œæ•´çš„Putä¿¡æ¯');
                return;
            }

            stockData.puts.push({
                strike: strike,
                premium: premium,
                expiry: expiry,
                date: new Date().toLocaleDateString('zh-TW'),
                id: Date.now(),
                closed: false,
                symbol: currentStock,
                exercised: false
            });

            document.getElementById('put-strike').value = '';
            document.getElementById('put-premium').value = '';
            document.getElementById('put-expiry').value = '';
            updateAvailableCash();
            updateDisplay();
        }

        // æ·»åŠ è²·å…¥Putæ“ä½œï¼ˆå¹³å€‰ï¼‰
        function addBuyPutOperation() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡æˆ–æ–°å¢è‚¡ç¥¨');
                return;
            }
            
            const stockData = getCurrentStockData();
            const strike = parseFloat(document.getElementById('buy-put-strike').value);
            const premium = parseFloat(document.getElementById('buy-put-premium').value);
            const expiry = document.getElementById('buy-put-expiry').value;
            
            if (!strike || !premium || !expiry) {
                alert('è«‹è¼¸å…¥å®Œæ•´çš„Putä¿¡æ¯');
                return;
            }

            // å°‹æ‰¾åŒ¹é…çš„è³£Putä¾†å¹³å€‰
            const matchingPut = stockData.puts.find(p => 
                !p.closed && 
                !p.exercised &&
                Math.abs(p.strike - strike) < 0.01 && 
                p.expiry === expiry
            );

            if (matchingPut) {
                matchingPut.closed = true;
                matchingPut.closePrice = premium;
                matchingPut.closeDate = new Date().toLocaleDateString('zh-TW');
            } else {
                // å¦‚æœæ²’æœ‰åŒ¹é…çš„ï¼Œè¨˜éŒ„ç‚ºè²·å…¥Putï¼ˆå¯èƒ½æ˜¯æ–°çš„é–‹å€‰ï¼‰
                stockData.buyPuts.push({
                    strike: strike,
                    premium: premium,
                    expiry: expiry,
                    date: new Date().toLocaleDateString('zh-TW'),
                    id: Date.now(),
                    symbol: currentStock
                });
            }

            document.getElementById('buy-put-strike').value = '';
            document.getElementById('buy-put-premium').value = '';
            document.getElementById('buy-put-expiry').value = '';
            updateAvailableCash();
            updateDisplay();
        }
        
        // Callè¢«è¡Œä½¿
        function exerciseCall() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡è‚¡ç¥¨');
                return;
            }
            
            const select = document.getElementById('exercise-call-select');
            const exercisePrice = parseFloat(document.getElementById('exercise-price').value);
            
            if (!select.value || !exercisePrice) {
                alert('è«‹é¸æ“‡Callä¸¦è¼¸å…¥è¡Œä½¿åƒ¹æ ¼');
                return;
            }
            
            const [symbol, callId] = select.value.split('_');
            const stockData = dashboardData.stocks[symbol];
            if (!stockData) return;
            
            const call = stockData.calls.find(c => c.id == callId);
            if (!call || call.exercised || call.closed) {
                alert('è©²Callå·²è¢«è¡Œä½¿æˆ–å·²å¹³å€‰');
                return;
            }
            
            // æ¨™è¨˜ç‚ºå·²è¡Œä½¿
            call.exercised = true;
            call.exercisePrice = exercisePrice;
            call.exerciseDate = new Date().toLocaleDateString('zh-TW');
            
            // è‡ªå‹•æ¸›å°‘è‚¡ç¥¨æŒå€‰ï¼ˆ100è‚¡ï¼Œå› ç‚º1å£Call = 100è‚¡ï¼‰
            stockData.operations.push({
                type: 'sell',
                shares: 100,
                price: call.strike,
                date: new Date().toLocaleDateString('zh-TW'),
                id: Date.now(),
                symbol: symbol,
                reason: `Callè¢«è¡Œä½¿ (${call.strike} Call)`
            });
            
            alert(`${symbol} $${call.strike} Callå·²è¢«è¡Œä½¿ï¼Œå·²è‡ªå‹•è³£å‡º100è‚¡ @ $${call.strike}`);
            document.getElementById('exercise-price').value = '';
            updateStockSelect();
            updateAvailableCash();
            updateDisplay();
        }
        
        // Putè¢«è¡Œä½¿
        function exercisePut() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡è‚¡ç¥¨');
                return;
            }
            
            const stockData = getCurrentStockData();
            const strike = parseFloat(prompt('è«‹è¼¸å…¥è¢«è¡Œä½¿çš„Putè¡Œæ¬Šåƒ¹ï¼š'));
            const exercisePrice = parseFloat(prompt('è«‹è¼¸å…¥è¡Œä½¿åƒ¹æ ¼ï¼ˆé€šå¸¸ç­‰æ–¼è¡Œæ¬Šåƒ¹ï¼‰ï¼š'));
            
            if (!strike || !exercisePrice) {
                return;
            }
            
            const put = stockData.puts.find(p => 
                !p.exercised && 
                !p.closed && 
                Math.abs(p.strike - strike) < 0.01
            );
            
            if (!put) {
                alert('æ‰¾ä¸åˆ°åŒ¹é…çš„Put');
                return;
            }
            
            // æ¨™è¨˜ç‚ºå·²è¡Œä½¿
            put.exercised = true;
            put.exercisePrice = exercisePrice;
            put.exerciseDate = new Date().toLocaleDateString('zh-TW');
            
            // è‡ªå‹•å¢åŠ è‚¡ç¥¨æŒå€‰ï¼ˆ100è‚¡ï¼Œå› ç‚º1å£Put = 100è‚¡ï¼‰
            stockData.operations.push({
                type: 'buy',
                shares: 100,
                price: put.strike,
                date: new Date().toLocaleDateString('zh-TW'),
                id: Date.now(),
                symbol: currentStock,
                reason: `Putè¢«è¡Œä½¿ (${put.strike} Put)`
            });
            
            alert(`${currentStock} $${put.strike} Putå·²è¢«è¡Œä½¿ï¼Œå·²è‡ªå‹•è²·å…¥100è‚¡ @ $${put.strike}`);
            updateAvailableCash();
            updateDisplay();
        }
        
        // æ›´æ–°è‚¡åƒ¹
        function updateStockPrice() {
            const price = parseFloat(document.getElementById('current-stock-price').value);
            if (price > 0 && currentStock) {
                if (!currentPrices.stocks[currentStock]) {
                    currentPrices.stocks[currentStock] = {stock: 0, calls: {}, puts: {}};
                }
                currentPrices.stocks[currentStock].stock = price;
                savePrices();
                updatePnL();
                updateDisplay();
            }
        }

        // æ¸…é™¤æ‰€æœ‰æ•¸æ“š
        function clearAll() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿ')) {
                dashboardData = {
                    capitalAdditions: [],
                    stocks: {}
                };
                currentPrices = {
                    stocks: {}
                };
                currentStock = '';
                document.getElementById('stock-symbol').value = '';
                document.getElementById('current-stock-price').value = '';
                document.getElementById('add-capital').value = '';
                updateStockSelect();
                localStorage.removeItem('tradingDashboard');
                localStorage.removeItem('tradingPrices');
                updateDisplay();
            }
        }

        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            if (!currentStock || !dashboardData.stocks[currentStock]) {
                // æ²’æœ‰é¸ä¸­è‚¡ç¥¨ï¼Œé¡¯ç¤ºç©ºç‹€æ…‹
                document.getElementById('total-shares').textContent = '0';
                document.getElementById('avg-cost').textContent = '0.00';
                document.getElementById('current-stage').textContent = 'æœªé¸æ“‡è‚¡ç¥¨';
                document.getElementById('decision-node').textContent = 'è«‹å…ˆé¸æ“‡æˆ–æ–°å¢è‚¡ç¥¨';
                document.getElementById('stock-positions').innerHTML = '<p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡è‚¡ç¥¨æŒå€‰</p>';
                document.getElementById('call-positions').innerHTML = '<p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡CallæŒå€‰</p>';
                document.getElementById('put-positions').innerHTML = '<p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡PutæŒå€‰</p>';
                updateAvailableCash();
                updatePnL();
                generateTasks(0, 0, [], []);
                updateHistory();
                return;
            }

            const stockData = getCurrentStockData();
            
            // è¨ˆç®—ç¸½æŒè‚¡æ•¸å’Œå¹³å‡æˆæœ¬ï¼ˆä½¿ç”¨FIFOæ–¹æ³•ï¼‰
            let totalShares = 0;
            let totalCost = 0;
            let buyQueue = [];
            
            stockData.operations.forEach(op => {
                if (op.type === 'buy') {
                    buyQueue.push({shares: op.shares, price: op.price});
                    totalShares += op.shares;
                    totalCost += op.shares * op.price;
                } else if (op.type === 'sell') {
                    let remaining = op.shares;
                    while (remaining > 0 && buyQueue.length > 0) {
                        if (buyQueue[0].shares <= remaining) {
                            remaining -= buyQueue[0].shares;
                            totalCost -= buyQueue[0].shares * buyQueue[0].price;
                            totalShares -= buyQueue[0].shares;
                            buyQueue.shift();
                        } else {
                            totalCost -= remaining * buyQueue[0].price;
                            totalShares -= remaining;
                            buyQueue[0].shares -= remaining;
                            remaining = 0;
                        }
                    }
                }
            });

            const avgCost = totalShares > 0 ? (totalCost / totalShares).toFixed(2) : 0;

            // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
            document.getElementById('total-shares').textContent = totalShares;
            document.getElementById('avg-cost').textContent = avgCost;

            // åˆ¤æ–·ç•¶å‰éšæ®µå’Œæ±ºç­–æ¨¹ç¯€é»
            const openCalls = stockData.calls.filter(c => !c.closed && !c.exercised);
            const openPuts = stockData.puts.filter(p => !p.closed && !p.exercised);
            const stage = determineStage(totalShares, openCalls, openPuts);
            document.getElementById('current-stage').textContent = stage.stage;
            document.getElementById('decision-node').textContent = stage.node;

            // æ›´æ–°æœªå¹³å€‰æŒå€‰é¡¯ç¤º
            updatePositions(currentStock, totalShares, avgCost, openCalls, openPuts);

            // æ›´æ–°å¯ç”¨è³‡é‡‘
            updateAvailableCash();

            // è¨ˆç®—æç›Š
            updatePnL();

            // ç”Ÿæˆä»»å‹™æ¸…å–®
            generateTasks(currentStock, totalShares, avgCost, openCalls, openPuts);

            // æ›´æ–°æ“ä½œæ­·å²
            updateHistory();
        }
        
        // æ›´æ–°å¯ç”¨è³‡é‡‘
        function updateAvailableCash() {
            if (!dashboardData.stocks) {
                dashboardData.stocks = {};
            }
            
            // è¨ˆç®—æ‰€æœ‰æ·»åŠ çš„è³‡é‡‘
            let totalCash = 0;
            if (dashboardData.capitalAdditions && dashboardData.capitalAdditions.length > 0) {
                totalCash = dashboardData.capitalAdditions.reduce((sum, addition) => sum + addition.amount, 0);
            }
            
            // è¨ˆç®—æ‰€æœ‰è‚¡ç¥¨çš„ç¾é‡‘æµ
            Object.keys(dashboardData.stocks).forEach(symbol => {
                const stock = dashboardData.stocks[symbol];
                
                // è‚¡ç¥¨è²·è³£ç¾é‡‘æµ
                stock.operations.forEach(op => {
                    if (op.type === 'buy') {
                        totalCash -= op.shares * op.price;
                    } else if (op.type === 'sell') {
                        totalCash += op.shares * op.price;
                    }
                });
                
                // æœŸæ¬Šæ¬Šåˆ©é‡‘ï¼ˆè³£å‡ºæ™‚æ”¶åˆ°æ¬Šåˆ©é‡‘ï¼Œè²·å›æ™‚æ”¯ä»˜ï¼‰
                stock.calls.forEach(call => {
                    if (!call.closed && !call.exercised) {
                        // æœªå¹³å€‰çš„è³£Callï¼Œå·²æ”¶åˆ°æ¬Šåˆ©é‡‘
                        totalCash += call.premium * 100;
                    } else if (call.closed) {
                        // å·²å¹³å€‰ï¼Œè¨ˆç®—æ·¨æç›Š
                        totalCash += (call.premium - call.closePrice) * 100;
                    }
                });
                
                stock.puts.forEach(put => {
                    if (!put.closed && !put.exercised) {
                        // æœªå¹³å€‰çš„è³£Putï¼Œå·²æ”¶åˆ°æ¬Šåˆ©é‡‘
                        totalCash += put.premium * 100;
                    } else if (put.closed) {
                        // å·²å¹³å€‰ï¼Œè¨ˆç®—æ·¨æç›Š
                        totalCash += (put.premium - put.closePrice) * 100;
                    }
                });
                
                // è²·å…¥çš„Call/Putï¼ˆé–‹å€‰æ™‚æ”¯ä»˜æ¬Šåˆ©é‡‘ï¼‰
                stock.buyCalls.forEach(buyCall => {
                    totalCash -= buyCall.premium * 100;
                });
                
                stock.buyPuts.forEach(buyPut => {
                    totalCash -= buyPut.premium * 100;
                });
            });
            
            const cashElement = document.getElementById('available-cash');
            if (cashElement) {
                cashElement.textContent = `$${totalCash.toFixed(2)}`;
            }
        }

        // æ›´æ–°æœªå¹³å€‰æŒå€‰é¡¯ç¤º
        function updatePositions(symbol, shares, avgCost, openCalls, openPuts) {
            // è‚¡ç¥¨æŒå€‰
            const stockDiv = document.getElementById('stock-positions');
            if (shares > 0) {
                const stockPrice = currentPrices.stocks[symbol]?.stock || 0;
                stockDiv.innerHTML = `
                    <div style="padding: 10px; background: #e3f2fd; border-radius: 6px; margin-bottom: 5px;">
                        <strong>${symbol}: ${shares} è‚¡</strong><br>
                        <span style="font-size: 0.9em; color: #666;">å¹³å‡æˆæœ¬: $${avgCost}</span>
                        ${stockPrice > 0 ? `<br><span style="font-size: 0.9em; color: #666;">å³æ™‚åƒ¹æ ¼: $${stockPrice.toFixed(2)}</span>` : ''}
                    </div>
                `;
            } else {
                stockDiv.innerHTML = '<p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡è‚¡ç¥¨æŒå€‰</p>';
            }

            // CallæŒå€‰
            const callDiv = document.getElementById('call-positions');
            if (openCalls.length > 0) {
                callDiv.innerHTML = openCalls.map(call => {
                    const key = `${symbol}_${call.strike}_${call.expiry}`;
                    const stockPriceData = currentPrices.stocks[symbol];
                    const currentPrice = stockPriceData?.calls?.[`${call.strike}_${call.expiry}`] || call.premium;
                    const pnl = (call.premium - currentPrice).toFixed(2);
                    const pnlColor = pnl >= 0 ? '#4caf50' : '#f44336';
                    return `
                        <div style="padding: 10px; background: #fff3e0; border-radius: 6px; margin-bottom: 5px;">
                            <strong>${symbol} $${call.strike} Call</strong><br>
                            <span style="font-size: 0.85em;">è³£å‡º: $${call.premium.toFixed(2)}</span><br>
                            <span style="font-size: 0.85em;">å³æ™‚: $<input type="number" value="${currentPrice}" step="0.01" onchange="updateCallPrice('${symbol}', '${call.strike}', '${call.expiry}', this.value)" style="width: 60px; padding: 2px; border: 1px solid #ddd; border-radius: 3px;"></span><br>
                            <span style="font-size: 0.85em; color: ${pnlColor}; font-weight: bold;">æç›Š: $${pnl}</span><br>
                            <span style="font-size: 0.8em; color: #999;">åˆ°æœŸ: ${call.expiry}</span>
                        </div>
                    `;
                }).join('');
            } else {
                callDiv.innerHTML = '<p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡CallæŒå€‰</p>';
            }

            // PutæŒå€‰
            const putDiv = document.getElementById('put-positions');
            if (openPuts.length > 0) {
                putDiv.innerHTML = openPuts.map(put => {
                    const key = `${symbol}_${put.strike}_${put.expiry}`;
                    const stockPriceData = currentPrices.stocks[symbol];
                    const currentPrice = stockPriceData?.puts?.[`${put.strike}_${put.expiry}`] || put.premium;
                    const pnl = (put.premium - currentPrice).toFixed(2);
                    const pnlColor = pnl >= 0 ? '#4caf50' : '#f44336';
                    return `
                        <div style="padding: 10px; background: #ffebee; border-radius: 6px; margin-bottom: 5px;">
                            <strong>${symbol} $${put.strike} Put</strong><br>
                            <span style="font-size: 0.85em;">è³£å‡º: $${put.premium.toFixed(2)}</span><br>
                            <span style="font-size: 0.85em;">å³æ™‚: $<input type="number" value="${currentPrice}" step="0.01" onchange="updatePutPrice('${symbol}', '${put.strike}', '${put.expiry}', this.value)" style="width: 60px; padding: 2px; border: 1px solid #ddd; border-radius: 3px;"></span><br>
                            <span style="font-size: 0.85em; color: ${pnlColor}; font-weight: bold;">æç›Š: $${pnl}</span><br>
                            <span style="font-size: 0.8em; color: #999;">åˆ°æœŸ: ${put.expiry}</span>
                        </div>
                    `;
                }).join('');
            } else {
                putDiv.innerHTML = '<p style="color: #999; font-style: italic; font-size: 0.9em;">ç„¡PutæŒå€‰</p>';
            }
        }

        // æ›´æ–°Callåƒ¹æ ¼
        function updateCallPrice(symbol, strike, expiry, price) {
            if (!currentPrices.stocks[symbol]) {
                currentPrices.stocks[symbol] = {stock: 0, calls: {}, puts: {}};
            }
            if (!currentPrices.stocks[symbol].calls) {
                currentPrices.stocks[symbol].calls = {};
            }
            currentPrices.stocks[symbol].calls[`${strike}_${expiry}`] = parseFloat(price);
            savePrices();
            updatePnL();
            updateDisplay();
        }

        // æ›´æ–°Putåƒ¹æ ¼
        function updatePutPrice(symbol, strike, expiry, price) {
            if (!currentPrices.stocks[symbol]) {
                currentPrices.stocks[symbol] = {stock: 0, calls: {}, puts: {}};
            }
            if (!currentPrices.stocks[symbol].puts) {
                currentPrices.stocks[symbol].puts = {};
            }
            currentPrices.stocks[symbol].puts[`${strike}_${expiry}`] = parseFloat(price);
            savePrices();
            updatePnL();
            updateDisplay();
        }

        // è¨ˆç®—æç›Šï¼ˆæ”¯æŒå¤šè‚¡ç¥¨ï¼‰
        function updatePnL() {
            let totalRealizedPnL = 0;
            let totalUnrealizedPnL = 0;
            
            // è¨ˆç®—æ‰€æœ‰æ·»åŠ çš„è³‡é‡‘
            let totalAssets = 0;
            if (dashboardData.capitalAdditions && dashboardData.capitalAdditions.length > 0) {
                totalAssets = dashboardData.capitalAdditions.reduce((sum, addition) => sum + addition.amount, 0);
            }

            // éæ­·æ‰€æœ‰è‚¡ç¥¨
            Object.keys(dashboardData.stocks).forEach(symbol => {
                const stock = dashboardData.stocks[symbol];
                let realizedPnL = 0;
                let unrealizedPnL = 0;
                
                // è‚¡ç¥¨å·²å¯¦ç¾æç›Š
                let buyQueue = [];
                stock.operations.forEach(op => {
                    if (op.type === 'buy') {
                        buyQueue.push({shares: op.shares, price: op.price});
                    } else if (op.type === 'sell') {
                        let remaining = op.shares;
                        while (remaining > 0 && buyQueue.length > 0) {
                            if (buyQueue[0].shares <= remaining) {
                                realizedPnL += buyQueue[0].shares * (op.price - buyQueue[0].price);
                                remaining -= buyQueue[0].shares;
                                buyQueue.shift();
                            } else {
                                realizedPnL += remaining * (op.price - buyQueue[0].price);
                                buyQueue[0].shares -= remaining;
                                remaining = 0;
                            }
                        }
                    }
                });

                // Callå·²å¯¦ç¾æç›Š
                stock.calls.forEach(call => {
                    if (call.closed && call.closePrice !== undefined) {
                        realizedPnL += (call.premium - call.closePrice) * 100;
                    }
                });

                // Putå·²å¯¦ç¾æç›Š
                stock.puts.forEach(put => {
                    if (put.closed && put.closePrice !== undefined) {
                        realizedPnL += (put.premium - put.closePrice) * 100;
                    }
                });

                // è¨ˆç®—ç•¶å‰è‚¡ç¥¨æŒå€‰å’Œæˆæœ¬
                let shares = 0;
                let cost = 0;
                buyQueue = [];
                stock.operations.forEach(op => {
                    if (op.type === 'buy') {
                        buyQueue.push({shares: op.shares, price: op.price});
                        shares += op.shares;
                        cost += op.shares * op.price;
                    } else if (op.type === 'sell') {
                        let remaining = op.shares;
                        while (remaining > 0 && buyQueue.length > 0) {
                            if (buyQueue[0].shares <= remaining) {
                                shares -= buyQueue[0].shares;
                                cost -= buyQueue[0].shares * buyQueue[0].price;
                                remaining -= buyQueue[0].shares;
                                buyQueue.shift();
                            } else {
                                shares -= remaining;
                                cost -= remaining * buyQueue[0].price;
                                buyQueue[0].shares -= remaining;
                                remaining = 0;
                            }
                        }
                    }
                });
                const avgCost = shares > 0 ? cost / shares : 0;

                // è‚¡ç¥¨æœªå¯¦ç¾æç›Š
                const stockPrice = currentPrices.stocks[symbol]?.stock || 0;
                if (stockPrice > 0 && shares > 0) {
                    unrealizedPnL += (stockPrice - avgCost) * shares;
                    totalAssets += stockPrice * shares;
                } else if (shares > 0) {
                    totalAssets += avgCost * shares;
                }

                // Callæœªå¯¦ç¾æç›Š
                const openCalls = stock.calls.filter(c => !c.closed && !c.exercised);
                openCalls.forEach(call => {
                    const key = `${call.strike}_${call.expiry}`;
                    const currentPrice = currentPrices.stocks[symbol]?.calls?.[key] || call.premium;
                    unrealizedPnL += (call.premium - currentPrice) * 100;
                });

                // Putæœªå¯¦ç¾æç›Š
                const openPuts = stock.puts.filter(p => !p.closed && !p.exercised);
                openPuts.forEach(put => {
                    const key = `${put.strike}_${put.expiry}`;
                    const currentPrice = currentPrices.stocks[symbol]?.puts?.[key] || put.premium;
                    unrealizedPnL += (put.premium - currentPrice) * 100;
                });

                totalRealizedPnL += realizedPnL;
                totalUnrealizedPnL += unrealizedPnL;
            });

            // æ›´æ–°é¡¯ç¤º
            const realizedColor = totalRealizedPnL >= 0 ? '#4caf50' : '#f44336';
            const unrealizedColor = totalUnrealizedPnL >= 0 ? '#4caf50' : '#f44336';
            
            document.getElementById('realized-pnl').textContent = `$${totalRealizedPnL.toFixed(2)}`;
            document.getElementById('realized-pnl').style.color = realizedColor;
            
            document.getElementById('unrealized-pnl').textContent = `$${totalUnrealizedPnL.toFixed(2)}`;
            document.getElementById('unrealized-pnl').style.color = unrealizedColor;
            
            document.getElementById('total-assets').textContent = `$${totalAssets.toFixed(2)}`;
        }

        // åˆ¤æ–·ç•¶å‰éšæ®µï¼ˆä½¿ç”¨æœªå¹³å€‰çš„callså’Œputsï¼‰
        function determineStage(shares, calls, puts) {
            if (shares === 0) {
                return { stage: 'æœªé–‹å§‹', node: 'ç­‰å¾…åˆå§‹å»ºå€‰' };
            }

            // æª¢æŸ¥æ˜¯å¦æœ‰Strangle
            if (calls.length > 0 && puts.length > 0) {
                return { 
                    stage: 'éšæ®µå››ï¼šStrangleç®¡ç†', 
                    node: 'æƒ…å¢ƒD1ï¼šStrangleç®¡ç†åˆ†æ”¯' 
                };
            }

            // æª¢æŸ¥æ˜¯å¦æœ‰Call
            if (calls.length > 0) {
                const latestCall = calls[calls.length - 1];
                const today = new Date();
                const expiry = new Date(latestCall.expiry);
                const daysUntilExpiry = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));

                if (daysUntilExpiry > 3) {
                    return { 
                        stage: 'éšæ®µäºŒï¼šé€±ä¸­ç®¡ç†', 
                        node: 'ç›£æ§GTCè¨‚å–®ï¼ˆ$5è²·å›Callï¼‰' 
                    };
                } else {
                    return { 
                        stage: 'éšæ®µä¸‰ï¼šçµç®—å‰', 
                        node: `ç­‰å¾…é€±äº”çµç®—ï¼ˆå‰©é¤˜${daysUntilExpiry}å¤©ï¼‰` 
                    };
                }
            }

            // æª¢æŸ¥æ˜¯å¦æœ‰Put
            if (puts.length > 0) {
                return { 
                    stage: 'éšæ®µå››ï¼šåªè³£Putéšæ®µ', 
                    node: 'ç­‰å¾…Putè¡Œæ¬Šæˆ–éæœŸ' 
                };
            }

            // åªæœ‰æŒè‚¡
            if (shares === 150) {
                return { 
                    stage: 'éšæ®µä¸€ï¼šåˆå§‹å»ºå€‰', 
                    node: 'éœ€è¦è³£å‡ºCovered Call' 
                };
            }

            return { 
                stage: 'éšæ®µå››ï¼šé‡å•Ÿéšæ®µ', 
                node: 'æ ¹æ“šæŒå€‰æ±ºå®šä¸‹ä¸€æ­¥' 
            };
        }

        // ç”Ÿæˆä»»å‹™æ¸…å–®ï¼ˆæ”¯æŒå¤šè‚¡ç¥¨ï¼‰
        function generateTasks(symbol, shares, avgCost, calls, puts) {
            const taskList = document.getElementById('task-list');
            const tasks = [];

            if (!symbol) {
                taskList.innerHTML = '<p style="color: #999; font-style: italic;">è«‹å…ˆé¸æ“‡æˆ–æ–°å¢è‚¡ç¥¨</p>';
                return;
            }

            if (shares === 0) {
                tasks.push(`ğŸ“ ${symbol}: è¼¸å…¥åˆå§‹è²·å…¥æ“ä½œï¼ˆå»ºè­°ï¼š150è‚¡ @ $11.00ï¼‰`);
                tasks.push(`ğŸ“ ${symbol}: è¼¸å…¥è³£Callæ“ä½œï¼ˆå»ºè­°ï¼š$12 Callï¼‰`);
            } else if (shares > 0 && calls.length === 0) {
                tasks.push(`âš ï¸ ${symbol}: ç«‹å³è³£å‡ºCovered Callï¼ˆå»ºè­°ï¼š$12 Callï¼‰`);
                tasks.push(`ğŸ“ ${symbol}: æ›GTCè¨‚å–®ï¼šä»¥$5è²·å›Callï¼ˆé–å®š90%åˆ©æ½¤ï¼‰`);
            } else if (calls.length > 0) {
                calls.forEach(call => {
                    const today = new Date();
                    const expiry = new Date(call.expiry);
                    const daysUntilExpiry = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
                    
                    tasks.push(`ğŸ“Š ${symbol}: ç›£æ§$${call.strike} Callåƒ¹æ ¼ï¼Œç•¶è·Œè‡³$5æ™‚GTCè¨‚å–®æœƒè‡ªå‹•æˆäº¤`);
                    tasks.push(`â° ${symbol}: $${call.strike} Callè·é›¢åˆ°æœŸé‚„æœ‰ ${daysUntilExpiry} å¤©`);
                    
                    if (daysUntilExpiry <= 1) {
                        tasks.push(`âš ï¸ ${symbol}: æº–å‚™é€±äº”çµç®—ï¼šæª¢æŸ¥è‚¡åƒ¹æ˜¯å¦æœƒè¶…é$${call.strike}`);
                    }
                });

                if (calls.length > 0 && puts.length > 0) {
                    tasks.push(`ğŸ”„ ${symbol}: Strangleç®¡ç†ï¼šç›£æ§Callå’ŒPutçš„åƒ¹æ ¼è®ŠåŒ–`);
                    tasks.push(`ğŸ“ ${symbol}: æ›GTCè¨‚å–®åˆ†åˆ¥è²·å›Callå’ŒPutï¼ˆé–å®š80-90%åˆ©æ½¤ï¼‰`);
                }
            }

            if (puts.length > 0 && calls.length === 0) {
                puts.forEach(put => {
                    tasks.push(`ğŸ“Š ${symbol}: ç›£æ§$${put.strike} Putåƒ¹æ ¼ï¼Œæº–å‚™åœ¨$${put.strike}è¡Œæ¬Šæ™‚åŠ å€‰`);
                });
            }

            // æ·»åŠ æ‰€æœ‰è‚¡ç¥¨çš„ä»»å‹™
            Object.keys(dashboardData.stocks).forEach(stockSymbol => {
                if (stockSymbol !== symbol) {
                    const stock = dashboardData.stocks[stockSymbol];
                    const openCalls = stock.calls.filter(c => !c.closed && !c.exercised);
                    const openPuts = stock.puts.filter(p => !p.closed && !p.exercised);
                    
                    if (openCalls.length > 0) {
                        openCalls.forEach(call => {
                            tasks.push(`ğŸ“Š ${stockSymbol}: ç›£æ§$${call.strike} Call`);
                        });
                    }
                    if (openPuts.length > 0) {
                        openPuts.forEach(put => {
                            tasks.push(`ğŸ“Š ${stockSymbol}: ç›£æ§$${put.strike} Put`);
                        });
                    }
                }
            });

            if (tasks.length === 0) {
                taskList.innerHTML = '<p style="color: #999; font-style: italic;">è«‹è¼¸å…¥æŒå€‰æ•¸æ“šä»¥ç”Ÿæˆä»»å‹™</p>';
            } else {
                taskList.innerHTML = '<ul style="list-style: none; padding: 0;">' + 
                    tasks.map(task => `<li style="padding: 8px; margin: 5px 0; background: #f0f0f0; border-radius: 4px;">${task}</li>`).join('') + 
                    '</ul>';
            }
        }
        
        // ç”Ÿæˆæ™ºèƒ½æ“ä½œå»ºè­°
        function generateSmartSuggestions() {
            if (!currentStock) {
                alert('è«‹å…ˆé¸æ“‡è‚¡ç¥¨');
                return;
            }
            
            const stockData = getCurrentStockData();
            const stockPrice = parseFloat(document.getElementById('current-stock-price').value) || 0;
            
            if (stockPrice <= 0) {
                alert('è«‹å…ˆè¼¸å…¥å³æ™‚è‚¡åƒ¹');
                return;
            }
            
            const suggestions = [];
            const shares = parseInt(document.getElementById('total-shares').textContent) || 0;
            const avgCost = parseFloat(document.getElementById('avg-cost').textContent) || 0;
            const openCalls = stockData.calls.filter(c => !c.closed && !c.exercised);
            const openPuts = stockData.puts.filter(p => !p.closed && !p.exercised);
            
            // åŸºæ–¼150è‚¡æ¨¡å‹çš„å»ºè­°
            if (shares === 0) {
                suggestions.push({
                    priority: 'high',
                    action: `å»ºè­°è²·å…¥${currentStock} 150è‚¡ @ $${stockPrice.toFixed(2)}`,
                    reason: 'åˆå§‹å»ºå€‰éšæ®µ'
                });
                suggestions.push({
                    priority: 'high',
                    action: `è²·å…¥å¾Œç«‹å³è³£å‡º${currentStock} $${(stockPrice * 1.1).toFixed(2)} Call`,
                    reason: 'Covered Callç­–ç•¥ï¼Œæ”¶å–æ¬Šåˆ©é‡‘'
                });
            } else if (shares > 0 && openCalls.length === 0) {
                const suggestedStrike = Math.ceil(stockPrice * 1.1);
                suggestions.push({
                    priority: 'high',
                    action: `ç«‹å³è³£å‡º${currentStock} $${suggestedStrike} Call`,
                    reason: 'éœ€è¦Covered Callä¿è­·ï¼Œæ”¶å–æ¬Šåˆ©é‡‘'
                });
                suggestions.push({
                    priority: 'medium',
                    action: `æ›GTCè¨‚å–®ï¼šä»¥$5è²·å›Callï¼ˆé–å®š90%åˆ©æ½¤ï¼‰`,
                    reason: 'ç•¶Callåƒ¹æ ¼ä¸‹è·Œæ™‚è‡ªå‹•å¹³å€‰'
                });
            } else if (openCalls.length > 0) {
                openCalls.forEach(call => {
                    const callPrice = currentPrices.stocks[currentStock]?.calls?.[`${call.strike}_${call.expiry}`] || call.premium;
                    const profitPercent = ((call.premium - callPrice) / call.premium * 100).toFixed(1);
                    
                    if (callPrice <= 5 && call.premium > 5) {
                        suggestions.push({
                            priority: 'high',
                            action: `ç«‹å³è²·å›${currentStock} $${call.strike} Call @ $${callPrice.toFixed(2)}`,
                            reason: `å·²å¯¦ç¾${profitPercent}%åˆ©æ½¤ï¼Œå»ºè­°å¹³å€‰`
                        });
                    } else if (stockPrice > call.strike * 0.95) {
                        suggestions.push({
                            priority: 'medium',
                            action: `ç›£æ§${currentStock}è‚¡åƒ¹ï¼Œæ¥è¿‘$${call.strike}ï¼ŒCallå¯èƒ½è¢«è¡Œä½¿`,
                            reason: 'è‚¡åƒ¹æ¥è¿‘è¡Œæ¬Šåƒ¹ï¼Œæº–å‚™æ‡‰å°'
                        });
                    }
                });
            }
            
            if (openPuts.length > 0) {
                openPuts.forEach(put => {
                    if (stockPrice <= put.strike * 0.9) {
                        suggestions.push({
                            priority: 'high',
                            action: `æº–å‚™${currentStock} $${put.strike} Putå¯èƒ½è¢«è¡Œä½¿ï¼Œæº–å‚™è²·å…¥100è‚¡`,
                            reason: 'è‚¡åƒ¹ä½æ–¼è¡Œæ¬Šåƒ¹ï¼ŒPutå¯èƒ½è¢«è¡Œä½¿'
                        });
                    }
                });
            }
            
            // é¡¯ç¤ºå»ºè­°
            const suggestionsDiv = document.getElementById('smart-suggestions');
            if (suggestions.length === 0) {
                suggestionsDiv.innerHTML = '<p style="color: #999; font-style: italic;">ç•¶å‰ç„¡ç‰¹æ®Šæ“ä½œå»ºè­°ï¼Œç¹¼çºŒç›£æ§æŒå€‰</p>';
            } else {
                suggestionsDiv.innerHTML = suggestions.map((s, i) => {
                    const priorityColor = s.priority === 'high' ? '#f44336' : '#ff9800';
                    return `
                        <div style="padding: 10px; margin: 5px 0; background: white; border-left: 4px solid ${priorityColor}; border-radius: 4px;">
                            <strong style="color: ${priorityColor};">${s.priority === 'high' ? 'ğŸ”´ é«˜å„ªå…ˆç´š' : 'ğŸŸ¡ ä¸­å„ªå…ˆç´š'}</strong><br>
                            <span style="font-weight: 500;">${s.action}</span><br>
                            <span style="font-size: 0.9em; color: #666;">åŸå› ï¼š${s.reason}</span>
                        </div>
                    `;
                }).join('');
            }
        }

        // æ›´æ–°æ“ä½œæ­·å²ï¼ˆæ”¯æŒå¤šè‚¡ç¥¨ï¼‰
        function updateHistory() {
            const historyDiv = document.getElementById('operation-history');
            const allOps = [];

            // æ·»åŠ è³‡é‡‘è¨˜éŒ„
            if (dashboardData.capitalAdditions && dashboardData.capitalAdditions.length > 0) {
                dashboardData.capitalAdditions.forEach(addition => {
                    allOps.push({
                        type: 'æ·»åŠ è³‡é‡‘',
                        desc: `$${addition.amount.toFixed(2)}`,
                        date: addition.date
                    });
                });
            }

            // éæ­·æ‰€æœ‰è‚¡ç¥¨çš„æ“ä½œ
            Object.keys(dashboardData.stocks).forEach(symbol => {
                const stock = dashboardData.stocks[symbol];
                
                stock.operations.forEach(op => {
                    allOps.push({
                        type: op.type === 'buy' ? 'è²·å…¥' : 'è³£å‡º',
                        desc: `${symbol}: ${op.shares}è‚¡ @ $${op.price.toFixed(2)}${op.reason ? ` (${op.reason})` : ''}`,
                        date: op.date
                    });
                });

                stock.calls.forEach(call => {
                    if (call.exercised) {
                        allOps.push({
                            type: 'Callè¢«è¡Œä½¿',
                            desc: `${symbol} $${call.strike.toFixed(2)} Callè¢«è¡Œä½¿ï¼Œè‡ªå‹•è³£å‡º100è‚¡ @ $${call.strike}`,
                            date: call.exerciseDate
                        });
                    } else if (call.closed) {
                        allOps.push({
                            type: 'è³£Callï¼ˆå·²å¹³å€‰ï¼‰',
                            desc: `${symbol} $${call.strike.toFixed(2)} Callï¼Œè³£å‡º $${call.premium.toFixed(2)}ï¼Œè²·å› $${call.closePrice.toFixed(2)}ï¼Œæç›Š $${((call.premium - call.closePrice) * 100).toFixed(2)}`,
                            date: call.closeDate
                        });
                    } else {
                        allOps.push({
                            type: 'è³£Call',
                            desc: `${symbol} $${call.strike.toFixed(2)} Callï¼Œæ¬Šåˆ©é‡‘ $${call.premium.toFixed(2)}`,
                            date: call.date
                        });
                    }
                });

                stock.puts.forEach(put => {
                    if (put.exercised) {
                        allOps.push({
                            type: 'Putè¢«è¡Œä½¿',
                            desc: `${symbol} $${put.strike.toFixed(2)} Putè¢«è¡Œä½¿ï¼Œè‡ªå‹•è²·å…¥100è‚¡ @ $${put.strike}`,
                            date: put.exerciseDate
                        });
                    } else if (put.closed) {
                        allOps.push({
                            type: 'è³£Putï¼ˆå·²å¹³å€‰ï¼‰',
                            desc: `${symbol} $${put.strike.toFixed(2)} Putï¼Œè³£å‡º $${put.premium.toFixed(2)}ï¼Œè²·å› $${put.closePrice.toFixed(2)}ï¼Œæç›Š $${((put.premium - put.closePrice) * 100).toFixed(2)}`,
                            date: put.closeDate
                        });
                    } else {
                        allOps.push({
                            type: 'è³£Put',
                            desc: `${symbol} $${put.strike.toFixed(2)} Putï¼Œæ¬Šåˆ©é‡‘ $${put.premium.toFixed(2)}`,
                            date: put.date
                        });
                    }
                });
            });

            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            allOps.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (allOps.length === 0) {
                historyDiv.innerHTML = '<p style="color: #999; font-style: italic;">å°šç„¡æ“ä½œè¨˜éŒ„</p>';
            } else {
                historyDiv.innerHTML = '<ul style="list-style: none; padding: 0;">' + 
                    allOps.map(op => 
                        `<li style="padding: 8px; margin: 5px 0; background: #f8f9fa; border-left: 3px solid #3498db; border-radius: 4px;">
                            <strong>${op.type}</strong> - ${op.desc} <span style="color: #999; font-size: 0.9em;">(${op.date})</span>
                        </li>`
                    ).join('') + 
                    '</ul>';
            }
        }

        // ç›£è½è‚¡ç¥¨ä»£è™Ÿè¼¸å…¥
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            const symbolInput = document.getElementById('stock-symbol');
            if (symbolInput) {
                symbolInput.value = dashboardData.stockSymbol;
                symbolInput.addEventListener('blur', function() {
                    dashboardData.stockSymbol = this.value;
                    saveData();
                });
            }

            // å®šæœŸæ›´æ–°é¡¯ç¤ºï¼ˆæ¯30ç§’ï¼‰
            setInterval(updateDisplay, 30000);
            
            // è¼‰å…¥ä¿å­˜çš„åƒ¹æ ¼
            const savedPrices = localStorage.getItem('tradingPrices');
            if (savedPrices) {
                currentPrices = JSON.parse(savedPrices);
                if (currentStock && currentPrices.stocks[currentStock]?.stock) {
                    document.getElementById('current-stock-price').value = currentPrices.stocks[currentStock].stock;
                }
            }
        });

        // ä¿å­˜åƒ¹æ ¼åˆ°localStorage
        function savePrices() {
            if (currentStock) {
                const stockPrice = parseFloat(document.getElementById('current-stock-price').value) || 0;
                if (stockPrice > 0) {
                    if (!currentPrices.stocks[currentStock]) {
                        currentPrices.stocks[currentStock] = {stock: 0, calls: {}, puts: {}};
                    }
                    currentPrices.stocks[currentStock].stock = stockPrice;
                }
            }
            localStorage.setItem('tradingPrices', JSON.stringify(currentPrices));
        }

        // ç•¶è‚¡åƒ¹æ”¹è®Šæ™‚ä¿å­˜
        document.addEventListener('DOMContentLoaded', function() {
            const stockPriceInput = document.getElementById('current-stock-price');
            if (stockPriceInput) {
                stockPriceInput.addEventListener('blur', function() {
                    savePrices();
                    updatePnL();
                });
            }
        });
    </script>
</body>
</html>

